# LJC Games 当前项目报告（面向技术负责人）

## 1. 项目形态与运行方式
- 前端：`Vite + 原生 JS` 单页应用，路由在 `ljc-game-frontend/src/main.js` 注册。
- 后端：`Spring Boot + MyBatis + MySQL`，REST API 分模块提供能力。
- 启动时数据库初始化：`spring.sql.init.mode=always`，自动执行 `schema.sql` 与 `data.sql`。
- 前端开发端口：`3000`，后端端口：`8080`，前端通过 `/api` 代理到后端。

## 2. 前端模块（页面、功能、展示效果）

### 2.1 登录模块 `/login`
- 功能：注册/登录。
- 展示：登录页，登录后写入 `localStorage` 并跳转大厅。

### 2.2 大厅模块 `/hall`
- 功能：
  - 展示玩家昵称、金币、钻石。
  - 展示武将缩略卡。
  - 展示兵力卡（步/弓/骑）。
  - 展示国家进度与功能入口。
- 展示效果：
  - 兵力显示按当前国家（`initialCiv`）的三基础兵种，不再汇总全国家兵力。
  - 卡片化布局，按钮跳转到武将、招兵、关卡、装备、宝石、技能等模块。

### 2.3 招兵模块 `/recruit`
- 功能：
  - 按国家解锁状态展示可招募兵种。
  - 支持基础兵和特种兵招募，数量步进调整。
  - 调用 `/hall/recruit` 招募并刷新金币/库存。
- 展示效果：
  - 列表卡片展示兵种图标、名称、当前拥有、招募单价。
  - 使用统一配置元数据文件 `src/config/gameData.js`。

### 2.4 武将管理模块 `/generals`
- 功能：
  - 展示武将列表与详情。
  - 激活、升级、升阶。
  - 装备槽点击穿戴，调起装备选择弹窗。
- 展示效果：
  - 武将面板显示：HP、攻击、速度、统率、技能信息。
  - 6槽位（武器/防具/头盔/鞋子/坐骑/饰品）可视化。
  - 仅展示可用装备（闲置或当前武将已装备）。

### 2.5 装备模块 `/equipment`
- 功能：
  - 获取装备清单并执行强化。
  - 展示装备模板名称、槽位、基础属性。
- 展示效果：
  - 每件装备显示：名称、强化等级、穿戴状态、基础 ATK/HP/SPD、强化消耗。

### 2.6 宝石模块 `/gem`
- 功能：
  - 宝石 5 合 1。
  - 选择装备孔位进行宝石镶嵌。
- 展示效果：
  - 左侧宝石分组（类型+等级+数量），满足条件可合成。
  - 右侧装备孔位状态（已镶嵌/空位）和弹窗选宝石流程。

### 2.7 技能模块 `/skill`
- 功能：
  - 选择武将，选择技能书学习技能（覆盖旧技能）。
  - 学习后刷新背包数量。
- 展示效果：
  - 技能书显示名称映射（301~306）而非纯 ID。
  - 武将横向选择卡与技能书网格列表。

### 2.8 关卡模块 `/stages`
- 功能：
  - 展示国家关卡进度。
  - 进入战前整备页。
- 展示效果：
  - 关卡列表按国家进度解锁状态展示。

### 2.9 战前整备模块 `/battle/prepare`
- 功能：
  - 选择主将。
  - 分配兵力并校验统率占用。
  - 发起故事战斗 `/battle/story/start`。
- 展示效果：
  - 仅显示当前出征国家可用兵种：三基础兵种 + 本国特种兵。
  - 统率显示为“占用值/上限 + 总兵数”，并实时禁用/启用出征按钮。
  - 统率占用使用兵种配置 `capCost` 计算。

### 2.10 战斗模块 `/battle`
- 功能：
  - 从 `/battle/state` 恢复战斗。
  - 调用 `/battle/turn` 推进回合。
  - 按事件流渲染日志、血量、兵堆栈变化。
- 展示效果：
  - 顶部显示回合与阶段（武将单挑/全军出击）。
  - 阶段 2 技能按钮禁用。
  - 支持展示 `PHASE_CHANGE`、`TROOP_ATTACK` roll 分流等日志。

## 3. 后端模块（控制器、服务、当前能力）

### 3.1 认证与玩家信息
- `AuthController`：`/auth/register`、`/auth/login`。
- `PlayerController`：
  - `/player/info`：玩家基础信息 + 兵力列表 + 当前国家 `initialCiv`。
  - `/player/progress`：四国进度。
- 对应服务：`AuthService`、`PlayerInfoService`、`PlayerInitService`。

### 3.2 大厅系统
- `HallController`：
  - 武将：激活/升级/升阶/查询。
  - 装备：穿戴、强化、查询。
  - 宝石：镶嵌、合成、查询。
  - 技能：学习、道具查询。
  - 招募：兵力招募。
- 对应服务：`HallService`（核心业务聚合）。
- 当前输出：
  - `UserGeneralVO` 包含 `name/atk/speed/capacity/skill` 等展示字段。
  - `UserEquipmentVO` 包含模板名、槽位、基础属性（含 `baseSpd`）。

### 3.3 战斗系统
- `BattleController`：
  - `/battle/state`：读取战斗状态。
  - `/battle/story/start`：开始主线战斗。
  - `/battle/turn`：推进战斗回合（含幂等 `clientTurnNo`）。
- 对应服务：`BattleService`，核心引擎在 `battle/core/BattleEngine`。
- 当前战斗流程：
  - 两阶段：`HERO_SOLO` -> `TROOP_WAR`。
  - 阶段切换基于战斗状态判定并发 `PHASE_CHANGE` 事件。
  - 兵种攻击采用 roll 分流：伤害拆分到敌方武将/兵线。
  - 一方无可战单位则结束并发 `BATTLE_END`。

### 3.4 特种兵机制（已接入引擎）
- `3001`：治疗型，行动时治疗己方英雄并恢复兵线前排。
- `3002`：AOE 分散型，对敌方兵堆栈均摊兵线伤害。
- `3003`：英雄增益型，提升己方英雄攻击倍率（持续回合）。
- `3004`：敌军减攻型，降低敌方小兵攻击倍率（持续回合）。

### 3.5 配置与关卡
- `StageController`：关卡配置读取（`/stage/story/{civ}/{stageNo}`）。
- `ConfigController`：技能配置读取（`/config/skills`）。
- `TroopController`：兵营招募接口（保留）。
- 对应服务：`StageService`、`TroopService`。

## 4. 数据与数值现状
- 数据源：`schema.sql` + `data.sql` 启动自动执行。
- 目前 `data.sql` 已包含：
  - 四国基础模板（武将、兵种、装备、宝石、技能映射）。
  - 故事关卡配置（含 CN 关卡重填）。
  - 测试账号、初始资产、技能书、兵力库存。
  - 特种兵与技能书映射、初始可测数据。
- 当前统率体系：
  - 前端整备按 `capCost` 计算占用。
  - 后端兵种模板 `cost` 与前端口径已同步调整。

## 5. 当前可直接联调的主流程
- 注册/登录 -> 大厅。
- 武将激活/升级/升阶 -> 装备强化 -> 宝石镶嵌/合成 -> 学技能。
- 招兵 -> 战前整备（统率校验）-> 开战 -> 回合推进 -> 结算返回。
- 国家关卡推进与解锁流程可走通。
