# LJC Games 阶段性任务（主线40关 + 兵种解锁/进化 + 图鉴）

## 0. 目标边界（本阶段）
- 保留当前数据库已有兵种数据作为初始版本，不重做全量兵种表。
- 先完成“可玩闭环”：闯关 -> 解锁兵种/武将/进化 -> 图鉴可见 -> 前端可展示。
- 主线先按 40 关框架搭好，数值允许后续继续打磨。

## 1. 主线40关结构化
- 设计四国主线章节结构（每国10关，共40关）。
- 明确每关基础信息：`civ`、`stageNo`、推荐战力、敌方配置、首通奖励。
- 将“解锁条件”挂在关卡通关事件上：
  - 解锁特种兵（攻略对应国家后开启）。
  - 解锁兵种进化节点。
  - 解锁指定武将。
- 输出统一关卡配置格式，避免后续写死在代码里。

## 2. 兵种解锁系统
- 定义兵种状态：未发现、可解锁、已解锁、可进化、已进化。
- 新增“玩家-兵种解锁进度”数据结构（按 user + troopId 记录）。
- 通关结算时触发解锁逻辑并落库。
- 招募接口增加解锁校验：未解锁兵种不可招募。

## 3. 三基础兵种进化系统（步/弓/骑）
- 设计基础进化规则：
  - 每个基础兵种至少 2 个进化阶（V1 先做 1 条主进化线）。
  - 进化解锁由关卡条件驱动（例如“X国Y关后可进化”）。
- 进化效果先做可控参数化：
  - 数值向：攻击、防御、速度、生命、统率消耗。
  - 机制向：可在后续加（如反击、溅射、破甲）。
- 战斗计算读取“当前进化形态”而不是固定兵种模板。

## 4. 特种兵解锁规则落地
- 当前四类特种兵沿用现有数据库配置（先不推翻）。
- 规则统一为：击破对应国家主线后解锁其特种兵。
- 特种兵在招募、战前编队、战斗结算、兵力展示中全链路可用。

## 5. 兵种图鉴（核心）
- 图鉴列表字段：名称、阵营、兵种类型、是否特种、当前状态、效果说明、解锁条件。
- 文案规范：明确展示“通过 X 国家 X 关解锁”。
- 未解锁时展示灰态卡片 + 明确解锁途径，不显示完整数值细节（可保留部分隐藏）。
- 已解锁时展示完整属性、进化路线与当前阶。

## 6. 英雄解锁并入主线
- 主线关卡支持挂载英雄解锁奖励。
- 玩家侧记录英雄解锁状态与来源关卡。
- 前端武将页增加“解锁来源”信息，避免玩家不知道去哪拿。

## 7. 前端改造（本阶段重点页面）
- 战前整备页：
  - 仅展示已解锁可上阵兵种。
  - 兵种多时支持分页/滚动/分类筛选（为十几个兵种做准备）。
- 招募页：
  - 显示“已解锁/未解锁”分组。
  - 未解锁项显示关卡条件提示。
- 兵力面板（主城）：
  - 继续保持动态渲染，不限制兵种数量。
  - 增加按类型或阵营排序，避免列表混乱。
- 新增图鉴页：
  - 支持按阵营、类型、状态筛选。
  - 支持查看进化树（V1 可先做线性展示）。

## 8. 后端接口清单（需要补齐）
- `GET /api/troop/codex`：兵种图鉴总览（含解锁条件与状态）。
- `GET /api/troop/progression`：玩家兵种解锁与进化进度。
- `POST /api/troop/evolve`：兵种进化操作。
- `POST /api/stage/settle`：关卡结算时统一下发新增解锁内容。
- 现有招募/战前编队接口增加解锁与进化形态校验。

## 9. 数据层任务
- 新增或扩展配置表：
  - 兵种解锁条件配置。
  - 兵种进化配置（前置、消耗、效果）。
  - 关卡奖励配置（解锁兵种/英雄）。
- 新增玩家进度表：
  - 玩家兵种解锁表。
  - 玩家兵种进化表。
- 初始化脚本保持“项目启动自动可用”，不需要手工单独执行。

## 10. 验收标准（完成定义）
- 玩家从新号进入后，可通过主线逐步解锁兵种与英雄。
- 四国特种兵按国家攻略进度解锁，未解锁前不可使用。
- 三基础兵种可进化，战斗中实际生效。
- 图鉴能准确显示“通过 X 国家 X 关解锁该兵种”。
- 前端在 10~20 个兵种下展示和交互正常，不错乱、不挤压。

## 11. 建议执行顺序
1. 先做数据结构与配置（关卡奖励、兵种解锁、进化配置）。
2. 再做后端解锁/进化逻辑与接口。
3. 接着接入前端战前整备、招募、主城兵力、图鉴页。
4. 最后做 40 关数值首轮平衡与联调验收。
