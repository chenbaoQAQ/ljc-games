<view class="container">
  <view class="header">
    <text class="gold">当前金币: {{gold}}</text>
  </view>

  <view class="army-card">
    <picker bindchange="bindGeneralChange" value="{{index}}" range="{{generals}}" range-key="name">
      <view class="picker-box">
        当前武将：<text class="picker-name">{{generals[index].name || '载入中...'}}</text>
      </view>
    </picker>

    <view class="army-info">
      <view class="army-title">当前带兵概览</view>
      <view class="army-grid">
        <block wx:if="{{currentArmyList && currentArmyList.length > 0}}">
          <view class="army-item" wx:for="{{currentArmyList}}" wx:key="type">
            <text class="unit-label">{{item.label}}</text>
            <text class="unit-value">{{item.count}}</text>
          </view>
        </block>
        <view wx:else class="empty-text">该武将麾下暂无士兵</view>
      </view>
    </view>
  </view>

  <view class="list-container">
    <view wx:for="{{unitList}}" wx:key="name" class="unit-card">
      <view class="unit-main">
        <view class="unit-desc">
          <text class="u-name">{{item.label}}</text>
          <text class="u-cost">单价: {{item.cost}}</text>
        </view>
        
        <view class="stepper">
          <view class="s-btn" bindtap="changeCount" data-index="{{index}}" data-type="sub">-</view>
          <input class="s-input" type="number" value="{{item.buyCount}}" bindinput="inputCount" data-index="{{index}}" />
          <view class="s-btn" bindtap="changeCount" data-index="{{index}}" data-type="add">+</view>
        </view>
      </view>

      <button 
        class="recruit-btn"
        type="primary" 
        bindtap="doRecruit" 
        data-name="{{item.name}}" 
        data-count="{{item.buyCount}}"
        disabled="{{!selectedGeneralId || item.buyCount <= 0}}">
        确认招募 (需 {{item.cost * item.buyCount}} 金币)
      </button>
    </view>
  </view>
  
  <button class="footer-btn" bindtap="goBack">返回主城</button>
</view>

<view class="result-overlay" wx:if="{{showResult}}" bindtap="closeResult">
  <view class="result-box" catchtap="stopBubble">
    <view class="res-title">—— 招募成功 ——</view>
    <view class="res-content">
      <view class="res-name">{{lastRecruitName}}</view>
      <view class="res-num">+ {{lastRecruitCount}}</view>
    </view>
    <view class="res-tip">点击空白处继续</view>
  </view>
</view>