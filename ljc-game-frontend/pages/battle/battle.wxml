<view style="padding: 20px;">
  <view wx:if="{{!showBattle}}">
    <view style="font-weight: bold; margin-bottom: 20rpx;">1. 选择出征主将：</view>
    <picker bindchange="bindGenChange" value="{{genIndex}}" range="{{generals}}" range-key="name">
      <view style="padding: 30rpx; border: 2rpx solid #409EFF; text-align: center; border-radius: 10rpx; background: #fff;">
        当前：{{generals[genIndex].name || '载入中...'}}
      </view>
    </picker>

    <view style="font-weight: bold; margin-top: 40rpx; margin-bottom: 20rpx;">2. 分配上阵兵力：</view>
    <view style="background: #f9f9f9; padding: 20rpx; border-radius: 10rpx;">
      <view style="display: flex; justify-content: space-between; font-size: 24rpx; margin-bottom: 10rpx;">
        <text>统帅值占用</text>
        <text style="color: {{currentSpace > maxLeadership ? 'red' : '#67C23A'}}">{{currentSpace}} / {{maxLeadership}}</text>
      </view>
      <progress percent="{{maxLeadership > 0 ? (currentSpace / maxLeadership) * 100 : 0}}" stroke-width="6" color="{{currentSpace > maxLeadership ? 'red' : '#67C23A'}}" />

      <block wx:if="{{troopAssignment.length > 0}}">
        <view wx:for="{{troopAssignment}}" wx:key="name" style="display: flex; align-items: center; justify-content: space-between; margin-top: 20rpx; border-bottom: 1rpx solid #eee; padding-bottom: 10rpx;">
          <view>
            <view style="font-size: 28rpx;">{{item.label}}</view>
            <view style="font-size: 22rpx; color: #999;">库存: {{item.reserve}} (占用: {{item.space}})</view>
          </view>
          <input type="number" value="{{item.assigned}}" bindinput="onCountInput" data-index="{{index}}" style="width: 100rpx; border: 1rpx solid #ccc; text-align: center; background: #fff;"/>
        </view>
      </block>
      <view wx:else style="padding: 20rpx; text-align: center; font-size: 24rpx; color: #999;">仓库中没有士兵，请先去兵营招募</view>
    </view>

    <button type="warn" style="margin-top: 40rpx;" bindtap="startBattle">擂鼓开战</button>
  </view>

  <scroll-view wx:else scroll-y="true" style="height: 80vh; background: #000; color: #0f0; padding: 20rpx; font-family: monospace;">
    <view wx:for="{{logs}}" wx:key="index" style="margin-bottom: 10rpx;">{{item}}</view>
    <button type="primary" style="margin-top: 20rpx;" bindtap="resetBattle">返回选将</button>
  </scroll-view>
</view>