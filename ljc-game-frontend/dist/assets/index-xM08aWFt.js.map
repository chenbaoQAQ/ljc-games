{"version":3,"file":"index-xM08aWFt.js","sources":["../../src/utils/router.js","../../src/api/index.js","../../src/pages/LoginPage.js","../../src/config/gameData.js","../../src/pages/HallPage.js","../../src/pages/RecruitPage.js","../../src/pages/GeneralsPage.js","../../src/pages/StageSelectionPage.js","../../src/pages/EquipmentPage.js","../../src/pages/GemPage.js","../../src/pages/SkillPage.js","../../src/pages/BattlePage.js","../../src/pages/BattlePreparePage.js","../../src/pages/CodexPage.js","../../src/main.js"],"sourcesContent":["// ç®€å•çš„è·¯ç”±ç®¡ç†å™¨\nclass Router {\n    constructor() {\n        this.routes = {};\n        this.currentRoute = null;\n    }\n\n    // æ³¨å†Œè·¯ç”±\n    register(path, component) {\n        this.routes[path] = component;\n    }\n\n    // å¯¼èˆªåˆ°æŒ‡å®šè·¯ç”±\n    navigate(path, params = {}) {\n        const component = this.routes[path];\n        if (!component) {\n            console.error(`Route not found: ${path}`);\n            return;\n        }\n\n        this.currentRoute = path;\n        const app = document.getElementById('app');\n        app.innerHTML = '';\n        component(app, params);\n    }\n\n    // è¿”å›ä¸Šä¸€é¡µ\n    back() {\n        window.history.back();\n    }\n}\n\nexport const router = new Router();\nexport default router;\n","// API åŸºç¡€é…ç½®\nconst API_BASE_URL = import.meta.env.VITE_API_BASE_URL || '/api';\n\n// HTTP è¯·æ±‚å°è£…\nclass API {\n    // é€šç”¨ JSON è¯·æ±‚\n    static async request(endpoint, options = {}) {\n        const url = `${API_BASE_URL}${endpoint}`;\n        const config = {\n            headers: {\n                'Content-Type': 'application/json',\n                ...options.headers,\n            },\n            ...options,\n        };\n\n        try {\n            const response = await fetch(url, config);\n            const contentType = response.headers.get('content-type') || '';\n\n            let data;\n            if (contentType.includes('application/json')) {\n                data = await response.json();\n            } else {\n                // åç«¯è¿”å›çº¯å­—ç¬¦ä¸²çš„æƒ…å†µ\n                data = await response.text();\n            }\n\n            if (!response.ok) {\n                const msg = (typeof data === 'object' && data.message) ? data.message : data;\n                throw new Error(msg || `è¯·æ±‚å¤±è´¥ (${response.status})`);\n            }\n\n            return data;\n        } catch (error) {\n            console.error(`API Error [${endpoint}]:`, error);\n            throw error;\n        }\n    }\n\n    // GET è¯·æ±‚ï¼šå‚æ•°æ‹¼åˆ° URL\n    static get(endpoint, params) {\n        const query = params ? '?' + new URLSearchParams(params).toString() : '';\n        return this.request(endpoint + query, { method: 'GET' });\n    }\n\n    // POST è¯·æ±‚ï¼šJSON Body\n    static post(endpoint, body) {\n        return this.request(endpoint, {\n            method: 'POST',\n            body: body ? JSON.stringify(body) : undefined,\n        });\n    }\n\n    // POST è¯·æ±‚ï¼šURL æŸ¥è¯¢å‚æ•° + JSON Body (åç«¯å¾ˆå¤šæ¥å£æ˜¯ @RequestParam + @RequestBody æ··åˆ)\n    static postWithParams(endpoint, params, body) {\n        const query = params ? '?' + new URLSearchParams(params).toString() : '';\n        return this.request(endpoint + query, {\n            method: 'POST',\n            body: body ? JSON.stringify(body) : undefined,\n        });\n    }\n}\n\n// ============ è®¤è¯ API ============\nexport const authAPI = {\n    // æ³¨å†Œï¼š@RequestBody RegisterReq {username, password, nickname, initialCiv}\n    register(username, password, nickname, initialCiv) {\n        return API.post('/auth/register', { username, password, nickname, initialCiv });\n    },\n\n    // ç™»å½•ï¼š@RequestBody LoginReq {username, password}  â†’ è¿”å›çº¯å­—ç¬¦ä¸²\n    login(username, password) {\n        return API.post('/auth/login', { username, password });\n    },\n};\n\n// ============ ç©å®¶ API ============\nexport const playerAPI = {\n    // GET /player/info?userId=xxx â†’ Result<PlayerInfoResp>\n    getInfo(userId) {\n        return API.get('/player/info', { userId });\n    },\n\n    // GET /player/progress?userId=xxx â†’ Result<List<UserCivProgressTbl>>\n    getProgress(userId) {\n        return API.get('/player/progress', { userId });\n    },\n};\n\n// ============ å¤§å… API ============\nexport const hallAPI = {\n    // GET /hall/generals?userId=xxx â†’ Result<List<UserGeneralTbl>>\n    getGenerals(userId) {\n        return API.get('/hall/generals', { userId });\n    },\n\n    // GET /hall/progress?userId=xxx â†’ Result<List<UserCivProgressTbl>>\n    getProgress(userId) {\n        return API.get('/hall/progress', { userId });\n    },\n\n    // POST /hall/general/upgrade?userId=xxx&generalId=xxx â†’ Result<String>\n    upgradeGeneral(userId, generalId) {\n        return API.postWithParams('/hall/general/upgrade', { userId, generalId });\n    },\n\n    // POST /hall/general/activate?userId=xxx&generalId=xxx â†’ Result<String>\n    activateGeneral(userId, generalId) {\n        return API.postWithParams('/hall/general/activate', { userId, generalId });\n    },\n\n    // POST /hall/general/ascend?userId=xxx&generalId=xxx â†’ Result<String>\n    ascendGeneral(userId, generalId) {\n        return API.postWithParams('/hall/general/ascend', { userId, generalId });\n    },\n\n    // POST /hall/recruit?userId=xxx  Body: {troopId, count} â†’ Result<String>\n    recruit(userId, troopId, count) {\n        return API.postWithParams('/hall/recruit', { userId }, { troopId, count });\n    },\n\n    // POST /hall/general/equip?userId=xxx  Body: {generalId, equipmentId} â†’ Result<String>\n    equipGeneral(userId, generalId, equipmentId) {\n        return API.postWithParams('/hall/general/equip', { userId }, { generalId, equipmentId });\n    },\n\n    // POST /hall/equipment/enhance?userId=xxx&equipmentId=xxx â†’ Result<String>\n    enhanceEquipment(userId, equipmentId) {\n        return API.postWithParams('/hall/equipment/enhance', { userId, equipmentId });\n    },\n\n    // POST /hall/skill/learn?userId=xxx&generalId=xxx&bookItemId=xxx â†’ Result<String>\n    learnSkill(userId, generalId, bookItemId) {\n        return API.postWithParams('/hall/skill/learn', { userId, generalId, bookItemId });\n    },\n\n    // POST /hall/gem/inlay?userId=xxx  Body: {equipmentId, socketIndex, gemId} â†’ Result<String>\n    inlayGem(userId, equipmentId, socketIndex, gemId) {\n        return API.postWithParams('/hall/gem/inlay', { userId }, { equipmentId, socketIndex, gemId });\n    },\n\n    // POST /hall/gem/combine?userId=xxx  Body: {gemType, level} â†’ Result<String>\n    combineGem(userId, gemType, level) {\n        return API.postWithParams('/hall/gem/combine', { userId }, { gemType, level });\n    },\n\n    // GET /hall/equipments?userId=xxx\n    getEquipments(userId) {\n        return API.get('/hall/equipments', { userId });\n    },\n\n    // GET /hall/gems?userId=xxx\n    getGems(userId) {\n        return API.get('/hall/gems', { userId });\n    },\n\n    // GET /hall/items?userId=xxx\n    getItems(userId) {\n        return API.get('/hall/items', { userId });\n    },\n};\n\n// ============ æˆ˜æ–— API ============\nexport const battleAPI = {\n    // POST /battle/story/start?userId=xxx  Body: {civ, stageNo, generalId, troopConfig}\n    startStoryBattle(userId, civ, stageNo, generalId, troopConfig) {\n        return API.postWithParams('/battle/story/start', { userId }, { civ, stageNo, generalId, troopConfig });\n    },\n\n    // POST /battle/turn?userId=xxx  Body: {castSkill}\n    processTurn: (userId, castSkill, clientTurnNo, tactics) => {\n        return API.postWithParams('/battle/turn', { userId }, { castSkill, clientTurnNo, tactics });\n    },\n\n    // GET /battle/state?userId=xxx\n    getBattleState(userId) {\n        return API.get('/battle/state', { userId });\n    },\n};\n\n// ============ å…³å¡ API ============\nexport const stageAPI = {\n    getStages(civ) {\n        return API.get('/stage/list', { civ });\n    },\n};\n\n// ============ å…µåŠ› API ============\n// ============ å…µåŠ› API ============\nexport const troopAPI = {\n    getTroops(userId) {\n        return API.get('/troop/list', { userId });\n    },\n    \n    // GET /troop/codex?userId=xxx\n    getCodex(userId) {\n        return API.get('/troop/codex', { userId });\n    },\n    \n    // POST /troop/evolve?userId=xxx Body: {troopId}\n    evolve(userId, troopId) {\n        return API.postWithParams('/troop/evolve', { userId }, { troopId });\n    },\n};\n\nexport default API;\n","import { authAPI } from '../api/index.js';\nimport { router } from '../utils/router.js';\n\nexport function LoginPage(container) {\n  container.innerHTML = `\n    <div class=\"login-container\">\n      <div class=\"login-card card\">\n        <h1 class=\"login-title\">LJC ä¸‰å›½ç¾¤è‹±ä¼ </h1>\n        <p class=\"login-subtitle\">é€é¹¿ä¸­åŸï¼Œé—®é¼å¤©ä¸‹</p>\n        \n        <div class=\"login-form\">\n          <div class=\"form-group\">\n            <label>è´¦å·</label>\n            <input type=\"text\" id=\"username\" class=\"form-input\" placeholder=\"è¯·è¾“å…¥è´¦å·\" />\n          </div>\n          \n          <div class=\"form-group\">\n            <label>å¯†ç </label>\n            <input type=\"password\" id=\"password\" class=\"form-input\" placeholder=\"è¯·è¾“å…¥å¯†ç \" />\n          </div>\n          \n          <!-- æ³¨å†Œæ¨¡å¼æ‰æ˜¾ç¤º -->\n          <div class=\"register-fields\" id=\"register-fields\" style=\"display: none;\">\n            <div class=\"form-group\">\n              <label>æ˜µç§°</label>\n              <input type=\"text\" id=\"nickname\" class=\"form-input\" placeholder=\"å–ä¸ªéœ¸æ°”çš„åå­—\" />\n            </div>\n            \n            <div class=\"form-group\">\n              <label>é€‰æ‹©åˆå§‹é˜µè¥</label>\n              <div class=\"civ-select\" id=\"civ-select\">\n                <div class=\"civ-option selected\" data-civ=\"CN\">\n                  <span class=\"civ-flag\">ğŸ‡¨ğŸ‡³</span>\n                  <span class=\"civ-name\">ä¸­å›½</span>\n                </div>\n                <div class=\"civ-option\" data-civ=\"JP\">\n                  <span class=\"civ-flag\">ğŸ‡¯ğŸ‡µ</span>\n                  <span class=\"civ-name\">æ—¥æœ¬</span>\n                </div>\n                <div class=\"civ-option\" data-civ=\"KR\">\n                  <span class=\"civ-flag\">ğŸ‡°ğŸ‡·</span>\n                  <span class=\"civ-name\">éŸ©å›½</span>\n                </div>\n                <div class=\"civ-option\" data-civ=\"GB\">\n                  <span class=\"civ-flag\">ğŸ‡¬ğŸ‡§</span>\n                  <span class=\"civ-name\">è‹±å›½</span>\n                </div>\n              </div>\n            </div>\n          </div>\n          \n          <div class=\"btn-row\">\n            <button class=\"btn btn-primary btn-full\" id=\"login-btn\">ç™»å½•</button>\n            <button class=\"btn btn-secondary btn-full\" id=\"register-btn\">æ³¨å†Œ</button>\n          </div>\n          \n          <div class=\"message\" id=\"message\"></div>\n        </div>\n      </div>\n    </div>\n  `;\n\n  // æ·»åŠ æ ·å¼\n  const style = document.createElement('style');\n  style.id = 'login-page-style';\n  document.getElementById('login-page-style')?.remove();\n  style.textContent = `\n    .login-container {\n      min-height: 100vh;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);\n      position: relative;\n      overflow: hidden;\n    }\n    \n    .login-container::before {\n      content: '';\n      position: absolute;\n      width: 500px;\n      height: 500px;\n      background: radial-gradient(circle, rgba(78, 205, 196, 0.1) 0%, transparent 70%);\n      border-radius: 50%;\n      top: -200px;\n      right: -200px;\n      animation: pulse 4s ease-in-out infinite;\n    }\n\n    .login-container::after {\n      content: '';\n      position: absolute;\n      width: 400px;\n      height: 400px;\n      background: radial-gradient(circle, rgba(255, 107, 53, 0.08) 0%, transparent 70%);\n      border-radius: 50%;\n      bottom: -150px;\n      left: -150px;\n      animation: pulse 5s ease-in-out infinite reverse;\n    }\n    \n    .login-card {\n      width: 100%;\n      max-width: 480px;\n      padding: 40px;\n      text-align: center;\n      position: relative;\n      z-index: 1;\n    }\n    \n    .login-title {\n      font-size: 2.5rem;\n      font-weight: bold;\n      background: linear-gradient(135deg, var(--primary-color), var(--accent-color));\n      -webkit-background-clip: text;\n      -webkit-text-fill-color: transparent;\n      background-clip: text;\n      margin-bottom: var(--spacing-sm);\n    }\n    \n    .login-subtitle {\n      color: var(--text-secondary);\n      font-size: 1.1rem;\n      margin-bottom: var(--spacing-xl);\n    }\n    \n    .login-form {\n      display: flex;\n      flex-direction: column;\n      gap: var(--spacing-md);\n    }\n    \n    .form-group {\n      text-align: left;\n    }\n    \n    .form-group label {\n      display: block;\n      margin-bottom: var(--spacing-sm);\n      color: var(--text-secondary);\n      font-size: 0.9rem;\n      font-weight: 600;\n    }\n    \n    .form-input {\n      width: 100%;\n      padding: 12px 16px;\n      background: rgba(255, 255, 255, 0.05);\n      border: 2px solid rgba(255, 255, 255, 0.1);\n      border-radius: var(--radius-md);\n      color: var(--text-primary);\n      font-size: 1rem;\n      transition: all 0.3s ease;\n    }\n    \n    .form-input:focus {\n      outline: none;\n      border-color: var(--secondary-color);\n      box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);\n    }\n\n    .register-fields {\n      display: flex;\n      flex-direction: column;\n      gap: var(--spacing-md);\n      animation: slideUp 0.3s ease;\n    }\n\n    .civ-select {\n      display: grid;\n      grid-template-columns: repeat(4, 1fr);\n      gap: var(--spacing-sm);\n    }\n\n    .civ-option {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      gap: 4px;\n      padding: 12px 8px;\n      background: rgba(255, 255, 255, 0.03);\n      border: 2px solid rgba(255, 255, 255, 0.1);\n      border-radius: var(--radius-md);\n      cursor: pointer;\n      transition: all 0.3s ease;\n    }\n\n    .civ-option:hover {\n      border-color: rgba(255, 255, 255, 0.3);\n      transform: translateY(-2px);\n    }\n\n    .civ-option.selected {\n      border-color: var(--secondary-color);\n      background: rgba(78, 205, 196, 0.1);\n      box-shadow: 0 0 12px rgba(78, 205, 196, 0.2);\n    }\n\n    .civ-flag { font-size: 1.8rem; }\n\n    .civ-name {\n      font-size: 0.85rem;\n      color: var(--text-secondary);\n      font-weight: 600;\n    }\n\n    .civ-option.selected .civ-name {\n      color: var(--secondary-color);\n    }\n\n    .btn-row {\n      display: flex;\n      gap: var(--spacing-md);\n    }\n\n    .btn-full { flex: 1; }\n    \n    .message {\n      font-size: 0.9rem;\n      min-height: 24px;\n      text-align: center;\n      transition: all 0.3s ease;\n    }\n\n    .message.error { color: var(--danger-color); }\n    .message.success { color: var(--success-color); }\n    .message.info { color: var(--secondary-color); }\n  `;\n  document.head.appendChild(style);\n\n  // === çŠ¶æ€ ===\n  let isRegisterMode = false;\n  let selectedCiv = 'CN';\n\n  // === DOM å¼•ç”¨ ===\n  const usernameInput = document.getElementById('username');\n  const passwordInput = document.getElementById('password');\n  const nicknameInput = document.getElementById('nickname');\n  const registerFields = document.getElementById('register-fields');\n  const loginBtn = document.getElementById('login-btn');\n  const registerBtn = document.getElementById('register-btn');\n  const messageEl = document.getElementById('message');\n  const civOptions = document.querySelectorAll('.civ-option');\n\n  // === é˜µè¥é€‰æ‹© ===\n  civOptions.forEach(opt => {\n    opt.addEventListener('click', () => {\n      civOptions.forEach(o => o.classList.remove('selected'));\n      opt.classList.add('selected');\n      selectedCiv = opt.dataset.civ;\n    });\n  });\n\n  // === æ˜¾ç¤ºæ¶ˆæ¯ ===\n  function showMessage(text, type = 'error') {\n    messageEl.className = `message ${type}`;\n    messageEl.textContent = text;\n  }\n\n  // === ç™»å½•æˆåŠŸå¤„ç† ===\n  function handleLoginSuccess(user) {\n    localStorage.setItem('userId', user.id);\n    localStorage.setItem('username', user.nickname);\n    showMessage('ç™»å½•æˆåŠŸï¼æ­£åœ¨è¿›å…¥æ¸¸æˆ...', 'success');\n    setTimeout(() => router.navigate('/hall'), 600);\n  }\n\n  // === åˆ‡æ¢æ³¨å†Œ/ç™»å½• ===\n  registerBtn.addEventListener('click', () => {\n    isRegisterMode = !isRegisterMode;\n    registerFields.style.display = isRegisterMode ? 'flex' : 'none';\n    loginBtn.textContent = isRegisterMode ? 'ç¡®è®¤æ³¨å†Œ' : 'ç™»å½•';\n    registerBtn.textContent = isRegisterMode ? 'è¿”å›ç™»å½•' : 'æ³¨å†Œ';\n    messageEl.textContent = '';\n  });\n\n  // === ä¸»æ“ä½œï¼ˆç™»å½• / æ³¨å†Œï¼‰ ===\n  loginBtn.addEventListener('click', async () => {\n    const username = usernameInput.value.trim();\n    const password = passwordInput.value.trim();\n\n    if (!username || !password) {\n      showMessage('è¯·è¾“å…¥è´¦å·å’Œå¯†ç ');\n      return;\n    }\n\n    loginBtn.disabled = true;\n    registerBtn.disabled = true;\n\n    try {\n      if (isRegisterMode) {\n        // --- æ³¨å†Œ ---\n        const nickname = nicknameInput.value.trim();\n        if (!nickname) {\n          showMessage('è¯·è¾“å…¥æ˜µç§°');\n          return;\n        }\n\n        loginBtn.textContent = 'æ³¨å†Œä¸­...';\n        const result = await authAPI.register(username, password, nickname, selectedCiv);\n        console.log('æ³¨å†Œç»“æœ:', result);\n\n        // åç«¯ç°åœ¨è¿”å› Result<UserTbl>: {code: 200, data: {id, nickname, ...}}\n        if (result.code === 200 && result.data) {\n          handleLoginSuccess(result.data);\n        } else {\n          showMessage(result.message || 'æ³¨å†Œå¤±è´¥');\n        }\n      } else {\n        // --- ç™»å½• ---\n        loginBtn.textContent = 'ç™»å½•ä¸­...';\n        const result = await authAPI.login(username, password);\n        console.log('ç™»å½•ç»“æœ:', result);\n\n        // åç«¯ç°åœ¨è¿”å› Result<UserTbl>: {code: 200, data: {id, nickname, ...}}\n        if (result.code === 200 && result.data) {\n          handleLoginSuccess(result.data);\n        } else {\n          showMessage(result.message || 'ç™»å½•å¤±è´¥');\n        }\n      }\n    } catch (error) {\n      showMessage(error.message || 'æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•');\n    } finally {\n      loginBtn.disabled = false;\n      registerBtn.disabled = false;\n      loginBtn.textContent = isRegisterMode ? 'ç¡®è®¤æ³¨å†Œ' : 'ç™»å½•';\n    }\n  });\n\n  // === å›è½¦æäº¤ ===\n  container.addEventListener('keypress', (e) => {\n    if (e.key === 'Enter') loginBtn.click();\n  });\n}\n","export const CIV_BASE_TROOP = {\n  CN: 2000,\n  JP: 2100,\n  KR: 2200,\n  GB: 2300,\n};\n\nexport const TROOP_CATALOG = {\n  2001: { troopId: 2001, civ: \"CN\", type: \"INF\", name: \"é‡ç›¾æ­¥å…µ\", icon: \"ğŸ›¡ï¸\", color: \"var(--inf-color)\", recruitGold: 22, capCost: 2, isElite: false },\n  2002: { troopId: 2002, civ: \"CN\", type: \"ARC\", name: \"å¼ºå¼©å…µ\", icon: \"ğŸ¹\", color: \"var(--arc-color)\", recruitGold: 24, capCost: 2, isElite: false },\n  2003: { troopId: 2003, civ: \"CN\", type: \"CAV\", name: \"è™è±¹éª‘\", icon: \"ğŸ\", color: \"var(--cav-color)\", recruitGold: 42, capCost: 3, isElite: false },\n\n  2101: { troopId: 2101, civ: \"JP\", type: \"INF\", name: \"è¶³è½»\", icon: \"ğŸ›¡ï¸\", color: \"var(--inf-color)\", recruitGold: 22, capCost: 2, isElite: false },\n  2102: { troopId: 2102, civ: \"JP\", type: \"ARC\", name: \"å¼“è¶³è½»\", icon: \"ğŸ¹\", color: \"var(--arc-color)\", recruitGold: 26, capCost: 2, isElite: false },\n  2103: { troopId: 2103, civ: \"JP\", type: \"CAV\", name: \"éª‘é©¬æ­¦è€…\", icon: \"ğŸ\", color: \"var(--cav-color)\", recruitGold: 45, capCost: 3, isElite: false },\n\n  2201: { troopId: 2201, civ: \"KR\", type: \"INF\", name: \"æ­¥å’\", icon: \"ğŸ›¡ï¸\", color: \"var(--inf-color)\", recruitGold: 23, capCost: 2, isElite: false },\n  2202: { troopId: 2202, civ: \"KR\", type: \"ARC\", name: \"é•¿å¼“æ‰‹\", icon: \"ğŸ¹\", color: \"var(--arc-color)\", recruitGold: 25, capCost: 2, isElite: false },\n  2203: { troopId: 2203, civ: \"KR\", type: \"CAV\", name: \"é‡éª‘å’\", icon: \"ğŸ\", color: \"var(--cav-color)\", recruitGold: 44, capCost: 3, isElite: false },\n\n  2301: { troopId: 2301, civ: \"GB\", type: \"INF\", name: \"é•¿æªæ­¥å…µ\", icon: \"ğŸ›¡ï¸\", color: \"var(--inf-color)\", recruitGold: 24, capCost: 2, isElite: false },\n  2302: { troopId: 2302, civ: \"GB\", type: \"ARC\", name: \"é•¿å¼“æ‰‹\", icon: \"ğŸ¹\", color: \"var(--arc-color)\", recruitGold: 28, capCost: 2, isElite: false },\n  2303: { troopId: 2303, civ: \"GB\", type: \"CAV\", name: \"é‡éª‘å£«\", icon: \"ğŸ\", color: \"var(--cav-color)\", recruitGold: 46, capCost: 3, isElite: false },\n\n  3001: { troopId: 3001, civ: \"CN\", type: \"ARC\", name: \"é’å›ŠåŒ»å®˜\", icon: \"ğŸ’Š\", color: \"#10b981\", recruitGold: 130, capCost: 3, isElite: true },\n  3002: { troopId: 3002, civ: \"JP\", type: \"ARC\", name: \"çˆ†è£‚ç«ç­’é˜Ÿ\", icon: \"ğŸ”¥\", color: \"#f97316\", recruitGold: 145, capCost: 3, isElite: true },\n  3003: { troopId: 3003, civ: \"KR\", type: \"INF\", name: \"å†›ä¹æ——å«\", icon: \"ğŸº\", color: \"#06b6d4\", recruitGold: 140, capCost: 3, isElite: true },\n  3004: { troopId: 3004, civ: \"GB\", type: \"INF\", name: \"ç ´ç”²å·¥å…µ\", icon: \"ğŸª“\", color: \"#a3a3a3\", recruitGold: 150, capCost: 3, isElite: true },\n};\n\nexport const EQUIPMENT_SLOT_LABEL = {\n  weapon: \"æ­¦å™¨\",\n  armor1: \"é˜²å…·\",\n  helm: \"å¤´ç›”\",\n  boots: \"é‹å­\",\n  mount: \"åéª‘\",\n  accessory: \"é¥°å“\",\n};\n\nexport const SKILL_BOOK_META = {\n  301: { name: \"é¼“èˆæŠ€èƒ½ä¹¦\" },\n  302: { name: \"æˆ˜åœ°åŒ»æ²»æŠ€èƒ½ä¹¦\" },\n  303: { name: \"æ¯’ç®­æŠ€èƒ½ä¹¦\" },\n  304: { name: \"å¨å‹æŠ€èƒ½ä¹¦\" },\n  305: { name: \"é“å£æŠ€èƒ½ä¹¦\" },\n  306: { name: \"ä¸€çŸ³äºŒé¸ŸæŠ€èƒ½ä¹¦\" },\n  307: { name: \"å·è¢­æŠ€èƒ½ä¹¦\" },\n  308: { name: \"çº¢é¢œå…‹åˆ¶æŠ€èƒ½ä¹¦\" },\n  309: { name: \"é“èº¯æŠ€èƒ½ä¹¦\" },\n  310: { name: \"æ˜“ä¼¤æŒæ§æŠ€èƒ½ä¹¦\" },\n  311: { name: \"åéœ‡æŠ€èƒ½ä¹¦\" },\n  312: { name: \"å…ˆæœºæŠ€èƒ½ä¹¦\" },\n  313: { name: \"é¿é”‹æŠ€èƒ½ä¹¦\" },\n};\n\nexport function getTroopMeta(troopId) {\n  return TROOP_CATALOG[troopId] || {\n    troopId,\n    civ: \"\",\n    type: \"INF\",\n    name: `å…µç§#${troopId}`,\n    icon: \"âš”ï¸\",\n    color: \"var(--text-secondary)\",\n    recruitGold: 20,\n    capCost: 1,\n    isElite: false,\n  };\n}\n\nexport function getTroopTypeName(type) {\n  const map = { INF: \"æ­¥å…µ\", ARC: \"å¼“å…µ\", CAV: \"éª‘å…µ\" };\n  return map[type] || type;\n}\n\nexport function getEquipmentSlotLabel(slot) {\n  return EQUIPMENT_SLOT_LABEL[slot] || \"è£…å¤‡\";\n}\n\nexport function getEquipmentSlotIcon(slot) {\n  if (slot === \"weapon\") return \"âš”ï¸\";\n  if (slot === \"armor1\") return \"ğŸ›¡ï¸\";\n  if (slot === \"helm\") return \"ğŸª–\";\n  if (slot === \"boots\") return \"ğŸ‘¢\";\n  if (slot === \"mount\") return \"ğŸ\";\n  if (slot === \"accessory\") return \"ğŸ’\";\n  return \"ğŸ“¦\";\n}\n","import { playerAPI, hallAPI } from '../api/index.js';\nimport { router } from '../utils/router.js';\nimport { getTroopMeta } from '../config/gameData.js';\n\nexport function HallPage(container) {\n  const userId = localStorage.getItem('userId');\n  if (!userId) {\n    router.navigate('/login');\n    return;\n  }\n\n  container.innerHTML = `\n    <div class=\"hall-container\">\n      <!-- é¡¶éƒ¨å¯¼èˆªæ  -->\n      <nav class=\"hall-nav\">\n        <div class=\"nav-left\">\n          <h1 class=\"hall-title\">ä¸‰å›½ç¾¤è‹±ä¼ </h1>\n          <span class=\"player-name\" id=\"player-name\">${localStorage.getItem('username') || 'ä¸»å…¬'}</span>\n        </div>\n        <div class=\"nav-right\">\n          <div class=\"resource-display\">\n            <div class=\"resource-item\">\n              <span class=\"resource-icon\">ğŸ’°</span>\n              <span id=\"gold-count\">0</span>\n            </div>\n            <div class=\"resource-item\">\n              <span class=\"resource-icon\">ğŸ’</span>\n              <span id=\"diamond-count\">0</span>\n            </div>\n          </div>\n          <button class=\"btn btn-secondary btn-sm\" id=\"logout-btn\">é€€å‡º</button>\n        </div>\n      </nav>\n\n      <!-- ä¸»å†…å®¹åŒº -->\n      <div class=\"hall-content container\">\n        <!-- æ­¦å°†å¡ç‰‡ -->\n        <div class=\"section-card card\">\n          <h2 class=\"card-title\">ğŸ‘¥ æ­¦å°†</h2>\n          <div class=\"generals-grid\" id=\"generals-grid\">\n            <div class=\"spinner\"></div>\n          </div>\n          <button class=\"btn btn-primary\" id=\"manage-generals-btn\">ç®¡ç†æ­¦å°†</button>\n        </div>\n\n        <!-- å…µåŠ›å¡ç‰‡ -->\n        <div class=\"section-card card\">\n          <h2 class=\"card-title\">âš”ï¸ å…µåŠ›</h2>\n          <div class=\"troops-grid\" id=\"troops-grid\">\n            <div class=\"spinner\"></div>\n          </div>\n          <button class=\"btn btn-primary\" id=\"recruit-btn\">æ‹›å‹Ÿå£«å…µ</button>\n        </div>\n\n        <!-- å…³å¡è¿›åº¦å¡ç‰‡ -->\n        <div class=\"section-card card\">\n          <h2 class=\"card-title\">ğŸ—ºï¸ å¾æˆ˜å››æ–¹</h2>\n          <div class=\"progress-grid\" id=\"progress-grid\">\n            <div class=\"spinner\"></div>\n          </div>\n          <button class=\"btn btn-success\" id=\"select-stage-btn\">é€‰æ‹©å…³å¡</button>\n        </div>\n\n        <!-- å…¶ä»–åŠŸèƒ½ -->\n        <div class=\"section-card card\">\n          <h2 class=\"card-title\">ğŸ”§ å…¶ä»–åŠŸèƒ½</h2>\n            <button class=\"btn btn-secondary\" id=\"equip-btn\">è£…å¤‡å¼ºåŒ–</button>\n            <button class=\"btn btn-secondary\" id=\"gem-btn\">å®çŸ³é•¶åµŒ</button>\n            <button class=\"btn btn-secondary\" id=\"skill-btn\">æŠ€èƒ½å­¦ä¹ </button>\n            <button class=\"btn btn-secondary\" id=\"codex-btn\">å…µç§å›¾é‰´</button>\n            <button class=\"btn btn-secondary\" id=\"tower-btn\">çˆ¬å¡”æŒ‘æˆ˜</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n\n  // æ·»åŠ æ ·å¼\n  const style = document.createElement('style');\n  style.textContent = `\n    .hall-container {\n      min-height: 100vh;\n      background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-medium) 100%);\n    }\n\n    .hall-nav {\n      background: rgba(0, 0, 0, 0.3);\n      backdrop-filter: blur(10px);\n      padding: var(--spacing-md) var(--spacing-lg);\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      border-bottom: 2px solid rgba(255, 255, 255, 0.1);\n      position: sticky;\n      top: 0;\n      z-index: 100;\n    }\n\n    .nav-left {\n      display: flex;\n      align-items: center;\n      gap: var(--spacing-lg);\n    }\n\n    .hall-title {\n      font-size: 1.5rem;\n      font-weight: bold;\n      background: linear-gradient(135deg, var(--primary-color), var(--accent-color));\n      -webkit-background-clip: text;\n      -webkit-text-fill-color: transparent;\n    }\n\n    .player-name {\n      color: var(--text-secondary);\n      font-size: 1.1rem;\n    }\n\n    .nav-right {\n      display: flex;\n      align-items: center;\n      gap: var(--spacing-lg);\n    }\n\n    .resource-display {\n      display: flex;\n      gap: var(--spacing-md);\n    }\n\n    .resource-item {\n      display: flex;\n      align-items: center;\n      gap: var(--spacing-sm);\n      padding: 8px 16px;\n      background: rgba(255, 255, 255, 0.05);\n      border-radius: var(--radius-lg);\n      font-weight: bold;\n    }\n\n    .resource-icon {\n      font-size: 1.2rem;\n    }\n\n    .btn-sm {\n      padding: 8px 16px;\n      font-size: 0.9rem;\n    }\n\n    .hall-content {\n      padding: var(--spacing-xl);\n      display: grid;\n      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));\n      gap: var(--spacing-lg);\n    }\n\n    .section-card {\n      height: fit-content;\n    }\n\n    .generals-grid {\n      display: grid;\n      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));\n      gap: var(--spacing-md);\n      margin-bottom: var(--spacing-md);\n      min-height: 100px;\n      align-items: center;\n      justify-items: center;\n    }\n\n    .general-card {\n      background: rgba(255, 255, 255, 0.05);\n      border: 2px solid rgba(255, 255, 255, 0.1);\n      border-radius: var(--radius-md);\n      padding: var(--spacing-md);\n      text-align: center;\n      transition: all 0.3s ease;\n      cursor: pointer;\n      width: 100%;\n    }\n\n    .general-card:hover {\n      transform: translateY(-5px);\n      border-color: var(--secondary-color);\n      box-shadow: 0 5px 15px rgba(78, 205, 196, 0.3);\n    }\n\n    .general-avatar {\n      width: 60px;\n      height: 60px;\n      border-radius: 50%;\n      margin: 0 auto var(--spacing-sm);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 2rem;\n      background: linear-gradient(135deg, var(--primary-color), var(--accent-color));\n    }\n\n    .general-name {\n      font-weight: bold;\n      color: var(--text-primary);\n      margin-bottom: var(--spacing-xs);\n    }\n\n    .general-level {\n      font-size: 0.85rem;\n      color: var(--text-secondary);\n    }\n\n    .troops-grid {\n      display: grid;\n      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n      gap: var(--spacing-md);\n      margin-bottom: var(--spacing-md);\n      max-height: 300px;\n      overflow-y: auto;\n      padding-right: 4px;\n    }\n\n    .troop-item {\n      display: flex;\n      align-items: center;\n      gap: var(--spacing-sm);\n      padding: var(--spacing-md);\n      background: rgba(255, 255, 255, 0.05);\n      border-radius: var(--radius-md);\n      border: 2px solid rgba(255, 255, 255, 0.1);\n      transition: all 0.3s ease;\n    }\n\n    .troop-item:hover {\n      transform: translateY(-2px);\n      box-shadow: var(--shadow-md);\n    }\n\n    .troop-icon {\n      width: 40px;\n      height: 40px;\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 1.5rem;\n    }\n\n    .troop-info {\n      display: flex;\n      flex-direction: column;\n      min-width: 0;\n    }\n\n    .troop-name {\n      font-size: 0.9rem;\n      color: var(--text-secondary);\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n\n    .troop-count {\n      font-size: 1.2rem;\n      font-weight: bold;\n      color: var(--text-primary);\n    }\n\n    .progress-grid {\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      gap: var(--spacing-md);\n      margin-bottom: var(--spacing-md);\n      min-height: 100px;\n      align-items: center;\n    }\n\n    .progress-item {\n      padding: var(--spacing-md);\n      background: rgba(255, 255, 255, 0.05);\n      border-radius: var(--radius-md);\n      border: 2px solid rgba(255, 255, 255, 0.1);\n    }\n\n    .progress-civ {\n      font-weight: bold;\n      margin-bottom: var(--spacing-sm);\n      display: flex;\n      align-items: center;\n      gap: var(--spacing-sm);\n    }\n\n    .progress-stage {\n      font-size: 0.9rem;\n      color: var(--text-secondary);\n    }\n\n    .actions-grid {\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      gap: var(--spacing-md);\n    }\n\n    @media (max-width: 768px) {\n      .hall-content {\n        grid-template-columns: 1fr;\n      }\n\n      .troops-grid {\n        grid-template-columns: 1fr;\n      }\n\n      .actions-grid {\n        grid-template-columns: 1fr;\n      }\n    }\n  `;\n  document.head.appendChild(style);\n\n  // åŠ è½½æ•°æ®\n  loadPlayerData();\n  loadGenerals();\n  loadProgress();\n\n  async function loadPlayerData() {\n    try {\n      const result = await playerAPI.getInfo(userId);\n      console.log('ç©å®¶æ•°æ®:', result);\n      if (result.code === 200 && result.data) {\n        document.getElementById('player-name').textContent = result.data.nickname;\n        document.getElementById('gold-count').textContent = (result.data.gold || 0).toLocaleString();\n        document.getElementById('diamond-count').textContent = (result.data.diamond || 0).toLocaleString();\n\n        renderTroops(result.data.troops || []);\n      } else {\n        console.warn('åŠ è½½ç©å®¶æ•°æ®: codeä¸ä¸º200', result);\n      }\n    } catch (error) {\n      console.error('åŠ è½½ç©å®¶æ•°æ®å¤±è´¥:', error);\n    }\n  }\n\n  async function loadGenerals() {\n    try {\n      const result = await hallAPI.getGenerals(userId);\n      console.log('æ­¦å°†æ•°æ®:', result);\n      const grid = document.getElementById('generals-grid');\n\n      if (result.code === 200 && result.data && result.data.length > 0) {\n        grid.innerHTML = result.data.slice(0, 4).map(general => `\n          <div class=\"general-card\" data-id=\"${general.id}\">\n            <div class=\"general-avatar\">ğŸ–ï¸</div>\n            <div class=\"general-name\">æ­¦å°†#${general.templateId}</div>\n            <div class=\"general-level\">Lv.${general.level}</div>\n            ${general.activated ? '<div class=\"badge badge-inf\">å·²æ¿€æ´»</div>' : '<div class=\"badge\" style=\"background:rgba(255,255,255,0.1)\">æœªæ¿€æ´»</div>'}\n          </div>\n        `).join('');\n      } else {\n        grid.innerHTML = '<p style=\"grid-column: 1/-1; text-align: center;\">æš‚æ— æ­¦å°†</p>';\n      }\n    } catch (error) {\n      console.error('åŠ è½½æ­¦å°†å¤±è´¥:', error);\n      document.getElementById('generals-grid').innerHTML =\n        '<p style=\"grid-column: 1/-1; text-align: center; color: var(--danger-color);\">åŠ è½½å¤±è´¥</p>';\n    }\n  }\n\n  async function loadProgress() {\n    try {\n      const result = await hallAPI.getProgress(userId);\n      console.log('è¿›åº¦æ•°æ®:', result);\n      const grid = document.getElementById('progress-grid');\n\n      if (result.code === 200 && result.data && result.data.length > 0) {\n        const civNames = { CN: 'ğŸ‡¨ğŸ‡³ ä¸­å›½', JP: 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬', KR: 'ğŸ‡°ğŸ‡· éŸ©å›½', GB: 'ğŸ‡¬ğŸ‡§ è‹±å›½' };\n        grid.innerHTML = result.data.map(prog => `\n          <div class=\"progress-item\">\n            <div class=\"progress-civ\">\n              <span class=\"badge badge-${prog.civ.toLowerCase()}\">${civNames[prog.civ] || prog.civ}</span>\n            </div>\n            <div class=\"progress-stage\">\n              å½“å‰è¿›åº¦: ${prog.maxStageCleared || 0}/10 å…³\n              ${prog.unlocked ? '' : '<br/><span style=\"color: var(--danger-color);\">ğŸ”’ æœªè§£é”</span>'}\n            </div>\n          </div>\n        `).join('');\n      } else {\n        grid.innerHTML = '<p style=\"grid-column: 1/-1; text-align: center;\">æš‚æ— è¿›åº¦</p>';\n      }\n    } catch (error) {\n      console.error('åŠ è½½è¿›åº¦å¤±è´¥:', error);\n    }\n  }\n\n  function renderTroops(troops) {\n    const grid = document.getElementById('troops-grid');\n    if (!grid) return;\n\n    const list = (troops || [])\n      .map(t => {\n        const meta = getTroopMeta(t.troopId);\n        return {\n          troopId: t.troopId,\n          count: t.count || 0,\n          civ: meta.civ,\n          type: meta.type,\n          icon: meta.icon,\n          name: meta.name,\n          color: meta.color,\n          isElite: !!meta.isElite,\n        };\n      })\n      .filter(t => t.count > 0)\n      .sort((a, b) => {\n        if (a.civ !== b.civ) return String(a.civ).localeCompare(String(b.civ));\n        if (a.isElite !== b.isElite) return a.isElite ? 1 : -1;\n        const typeOrder = { INF: 1, ARC: 2, CAV: 3 };\n        return (typeOrder[a.type] || 9) - (typeOrder[b.type] || 9);\n      });\n\n    if (list.length === 0) {\n      grid.innerHTML = '<p style=\"grid-column: 1/-1; text-align: center;\">æš‚æ— å…µåŠ›</p>';\n      return;\n    }\n\n    grid.innerHTML = list.map(troop => `\n      <div class=\"troop-item\">\n        <div class=\"troop-icon\" style=\"background: ${troop.color};\">${troop.icon}</div>\n        <div class=\"troop-info\">\n          <span class=\"troop-name\">[${troop.civ}] ${troop.name}${troop.isElite ? ' [ç‰¹ç§]' : ''}</span>\n          <span class=\"troop-count\">${troop.count.toLocaleString()}</span>\n        </div>\n      </div>\n    `).join('');\n  }\n\n  // äº‹ä»¶ç»‘å®š\n  document.getElementById('logout-btn').addEventListener('click', () => {\n    localStorage.clear();\n    router.navigate('/login');\n  });\n\n  document.getElementById('select-stage-btn').addEventListener('click', () => {\n    router.navigate('/stages');\n  });\n\n  document.getElementById('manage-generals-btn').addEventListener('click', () => {\n    router.navigate('/generals');\n  });\n\n  document.getElementById('recruit-btn').addEventListener('click', () => { router.navigate('/recruit'); });\n  document.getElementById('equip-btn').addEventListener('click', () => { router.navigate('/equipment'); });\n  document.getElementById('gem-btn').addEventListener('click', () => { router.navigate('/gem'); });\n  document.getElementById('skill-btn').addEventListener('click', () => { router.navigate('/skill'); });\n  document.getElementById('codex-btn').addEventListener('click', () => { router.navigate('/codex'); });\n  document.getElementById('tower-btn').addEventListener('click', () => { alert('çˆ¬å¡”åŠŸèƒ½æ•¬è¯·æœŸå¾…'); });\n}\n","import { playerAPI, hallAPI, troopAPI } from '../api/index.js';\nimport { router } from '../utils/router.js';\nimport { getTroopMeta, getTroopTypeName } from '../config/gameData.js';\n\nexport function RecruitPage(container) {\n  const userId = localStorage.getItem('userId');\n  if (!userId) { router.navigate('/login'); return; }\n\n  container.innerHTML = `\n    <div class=\"recruit-page\">\n      <nav class=\"page-nav\">\n        <button class=\"btn btn-secondary btn-sm\" id=\"back-btn\">â† è¿”å›å¤§å…</button>\n        <h1 class=\"page-title\">æ‹›å…µä¹°é©¬</h1>\n        <div class=\"nav-gold\">ğŸ’° <span id=\"gold-display\">--</span></div>\n      </nav>\n\n      <div class=\"recruit-content\" id=\"recruit-list\">\n        <div class=\"spinner\"></div>\n      </div>\n\n      <div class=\"toast\" id=\"toast\"></div>\n    </div>\n  `;\n\n  const style = document.createElement('style');\n  style.id = 'recruit-page-style';\n  document.getElementById('recruit-page-style')?.remove();\n  style.textContent = `\n    .recruit-page { min-height: 100vh; background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-medium) 100%); }\n    .page-nav { background: rgba(0,0,0,0.3); backdrop-filter: blur(10px); padding: var(--spacing-md) var(--spacing-lg); display:flex; align-items:center; gap: var(--spacing-lg); border-bottom: 2px solid rgba(255,255,255,0.1); position: sticky; top: 0; z-index: 100; }\n    .page-title { flex: 1; font-size: 1.3rem; background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }\n    .nav-gold { font-weight: bold; font-size: 1.1rem; }\n    .recruit-content { max-width: 900px; margin: 0 auto; padding: var(--spacing-xl); display: flex; flex-direction: column; gap: var(--spacing-lg); }\n    .recruit-card { display:flex; flex-direction:column; gap: var(--spacing-md); }\n    .troop-header { display:flex; align-items:center; gap: var(--spacing-md); }\n    .troop-avatar { width:56px; height:56px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size: 1.8rem; }\n    .troop-header h3 { margin:0; font-size: 1.2rem; }\n    .troop-desc { margin:4px 0 0; font-size:.85rem; color:var(--text-secondary); }\n    .troop-stats { display:flex; justify-content:space-between; padding:8px 12px; background: rgba(255,255,255,.03); border-radius: var(--radius-sm); font-size:.95rem; color: var(--text-secondary); }\n    .recruit-controls { display:flex; align-items:center; gap:8px; justify-content:center; }\n    .qty-btn { background: rgba(255,255,255,.08)!important; border:1px solid rgba(255,255,255,.15)!important; min-width:42px; }\n    .recruit-input { width:80px; text-align:center; padding:8px; background: rgba(255,255,255,.05); border:2px solid rgba(255,255,255,.15); border-radius: var(--radius-sm); color: var(--text-primary); font-size: 1rem; font-weight: bold; }\n    .recruit-btn { align-self: stretch; }\n    .toast { position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); padding: 12px 28px; border-radius: var(--radius-lg); font-weight: bold; opacity: 0; pointer-events: none; transition: opacity .3s ease, transform .3s ease; z-index: 999; }\n    .toast.show { opacity: 1; transform: translateX(-50%) translateY(-10px); }\n    .toast.success { background: var(--success-color); color:#fff; }\n    .toast.error { background: var(--danger-color); color:#fff; }\n  `;\n  document.head.appendChild(style);\n\n  loadData();\n\n  async function loadData() {\n    try {\n      const [infoRes, codexRes] = await Promise.all([\n        playerAPI.getInfo(userId),\n        troopAPI.getCodex(userId),\n      ]);\n\n      const ownedTroopsMap = {};\n      if (infoRes.code === 200 && infoRes.data) {\n        document.getElementById('gold-display').textContent = (infoRes.data.gold || 0).toLocaleString();\n        (infoRes.data.troops || []).forEach(t => { ownedTroopsMap[t.troopId] = t.count || 0; });\n      }\n\n      let codexList = [];\n      if (codexRes.code === 200 && codexRes.data) {\n        codexList = codexRes.data;\n      }\n\n      // Sort: Unlocked first, then by ID\n      codexList.sort((a, b) => {\n        if (a.status !== b.status) return b.status - a.status; // 2=Unlocked, 1=Discovered, 0=Locked\n        return a.troopId - b.troopId;\n      });\n\n      renderTroops(codexList, ownedTroopsMap);\n    } catch (e) {\n      console.error('åŠ è½½æ•°æ®å¤±è´¥:', e);\n      document.getElementById('recruit-list').innerHTML = '<p style=\"text-align:center\">åŠ è½½å¤±è´¥</p>';\n    }\n  }\n\n  function renderTroops(troops, ownedMap) {\n    const list = document.getElementById('recruit-list');\n    list.innerHTML = troops.map(t => {\n      // Merge with local meta for colors/icons (or backend should provide, but for now mix)\n      const meta = getTroopMeta(t.troopId);\n      const isLocked = t.status < 2; // 2=UNLOCKED\n      const opacity = isLocked ? '0.6' : '1';\n      const grayscale = isLocked ? 'filter: grayscale(1);' : '';\n\n      return `\n      <div class=\"recruit-card card\" data-troop-id=\"${t.troopId}\" style=\"${grayscale} opacity: ${opacity}\">\n        <div class=\"troop-header\">\n          <div class=\"troop-avatar\" style=\"background:${meta.color};\">${isLocked ? 'ğŸ”’' : meta.icon}</div>\n          <div>\n            <h3>${t.name} ${t.isElite ? '<span style=\"font-size:.8em;color:#ffd166\">[ç‰¹ç§]</span>' : ''}</h3>\n            <p class=\"troop-desc\">${getTroopTypeName(t.type)} Â· ${t.civ}</p>\n          </div>\n        </div>\n        <div class=\"troop-stats\">\n          ${isLocked\n          ? `<span><span style=\"color:#ef4444\">æœªè§£é”</span>`\n          : `<span>å½“å‰: <strong>${(ownedMap[t.troopId] || 0).toLocaleString()}</strong></span>`\n        }\n          <span>å•ä»·: <strong>${meta.recruitGold}</strong> é‡‘</span>\n        </div>\n        \n        ${isLocked ? `\n            <div style=\"font-size:0.9em; color:#ef4444; text-align:center; padding:10px; background:rgba(0,0,0,0.2); border-radius:4px;\">\n                ${t.unlockHint || `éœ€é€šå…³ ${t.civ} å…³å¡è§£é”`}\n            </div>\n        ` : `\n            <div class=\"recruit-controls\">\n              <button class=\"btn btn-sm qty-btn\" data-delta=\"-10\">-10</button>\n              <button class=\"btn btn-sm qty-btn\" data-delta=\"-1\">-1</button>\n              <input type=\"number\" class=\"recruit-input\" id=\"qty-${t.troopId}\" value=\"10\" min=\"1\" />\n              <button class=\"btn btn-sm qty-btn\" data-delta=\"1\">+1</button>\n              <button class=\"btn btn-sm qty-btn\" data-delta=\"10\">+10</button>\n            </div>\n            <button class=\"btn btn-primary recruit-btn\" data-troop-id=\"${t.troopId}\">æ‹›å‹Ÿ</button>\n        `}\n      </div>\n    `}).join('');\n\n    bindEvents();\n  }\n\n  function bindEvents() {\n    document.querySelectorAll('.qty-btn').forEach(btn => {\n      btn.onclick = () => {\n        const input = btn.parentElement.querySelector('.recruit-input');\n        const delta = parseInt(btn.dataset.delta || '0', 10);\n        const val = Math.max(1, (parseInt(input.value || '1', 10) || 1) + delta);\n        input.value = String(val);\n      };\n    });\n\n    document.querySelectorAll('.recruit-btn').forEach(btn => {\n      btn.onclick = async () => {\n        const troopId = parseInt(btn.dataset.troopId || '0', 10);\n        const input = document.getElementById(`qty-${troopId}`);\n        const count = parseInt(input?.value || '0', 10);\n        if (count <= 0) return;\n\n        btn.disabled = true;\n        try {\n          const res = await hallAPI.recruit(userId, troopId, count);\n          if (res.code === 200) {\n            showToast('æ‹›å‹ŸæˆåŠŸ', 'success');\n            loadData();\n          } else {\n            showToast(res.message || 'æ‹›å‹Ÿå¤±è´¥', 'error');\n          }\n        } catch (e) {\n          showToast(e.message || 'è¯·æ±‚å¤±è´¥', 'error');\n        } finally {\n          btn.disabled = false;\n        }\n      };\n    });\n  }\n\n  document.getElementById('back-btn').addEventListener('click', () => router.navigate('/hall'));\n\n  function showToast(msg, type = 'success') {\n    const toast = document.getElementById('toast');\n    toast.textContent = msg;\n    toast.className = `toast ${type} show`;\n    setTimeout(() => { toast.className = 'toast'; }, 2000);\n  }\n}\n","import { hallAPI, playerAPI } from '../api/index.js';\nimport { router } from '../utils/router.js';\n\nexport function GeneralsPage(container) {\n  const userId = localStorage.getItem('userId');\n  if (!userId) { router.navigate('/login'); return; }\n\n  let allEquipments = [];\n  let currentGeneralId = null;\n  let currentSlotKey = null;\n\n  const SLOT_CONFIG = [\n    { key: 'weapon', label: 'æ­¦å™¨', icon: 'âš”ï¸' },\n    { key: 'armor1', label: 'é˜²å…·', icon: 'ğŸ›¡ï¸' },\n    { key: 'helm', label: 'å¤´ç›”', icon: 'ğŸª–' },\n    { key: 'boots', label: 'é‹å­', icon: 'ğŸ‘¢' },\n    { key: 'mount', label: 'åéª‘', icon: 'ğŸ' },\n    { key: 'accessory', label: 'é¥°å“', icon: 'ğŸ’' },\n  ];\n\n  container.innerHTML = `\n    <div class=\"generals-page\">\n      <nav class=\"page-nav\">\n        <button class=\"btn btn-secondary btn-sm\" id=\"back-btn\">â† è¿”å›å¤§å…</button>\n        <h1 class=\"page-title\">ğŸ‘¥ æ­¦å°†ç®¡ç†</h1>\n        <div class=\"nav-gold\">ğŸ’° <span id=\"gold-display\">--</span></div>\n      </nav>\n\n      <div class=\"generals-content\" id=\"generals-content\">\n        <div class=\"spinner\" style=\"margin: 60px auto;\"></div>\n      </div>\n\n      <!-- è£…å¤‡é€‰æ‹©æ¨¡æ€æ¡† -->\n      <div class=\"modal-overlay\" id=\"equip-modal\" style=\"display:none;\">\n        <div class=\"modal\">\n          <div class=\"modal-header\">\n            <h3>é€‰æ‹©è£…å¤‡</h3>\n            <button class=\"close-btn\" id=\"close-modal\">Ã—</button>\n          </div>\n          <div class=\"modal-body\" id=\"equip-list\">\n          </div>\n        </div>\n      </div>\n\n      <div class=\"toast\" id=\"toast\"></div>\n    </div>\n  `;\n\n  const style = document.createElement('style');\n  style.id = 'generals-page-style';\n  document.getElementById('generals-page-style')?.remove();\n  style.textContent = `\n    .generals-page { min-height: 100vh; background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-medium) 100%); }\n    .page-nav { background: rgba(0,0,0,0.3); backdrop-filter: blur(10px); padding: 15px 20px; display: flex; align-items: center; gap: 20px; border-bottom: 2px solid rgba(255,255,255,0.1); position: sticky; top: 0; z-index: 100; }\n    .page-title { flex: 1; font-size: 1.3rem; background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }\n    .nav-gold { font-weight: bold; font-size: 1.1rem; }\n    .btn-sm { padding: 6px 14px; font-size: 0.85rem; }\n\n    .generals-content { max-width: 1000px; margin: 0 auto; padding: 20px; display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }\n    \n    .general-detail-card {\n      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 15px;\n      display: flex; flex-direction: column; gap: 12px; transition: all 0.3s;\n    }\n    .general-detail-card:hover { border-color: var(--secondary-color); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }\n    .general-detail-card.inactive { opacity: 0.6; }\n\n    .gd-top { display: flex; align-items: center; gap: 15px; }\n    .gd-avatar { width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }\n    .gd-info { flex: 1; }\n    .gd-name { font-weight: bold; font-size: 1.1rem; }\n    .gd-meta { font-size: 0.8rem; color: #aaa; }\n    \n    .stats-row { display: flex; justify-content: space-between; background: rgba(0,0,0,0.2); padding: 8px; border-radius: 4px; font-size: 0.85rem; }\n    .stat-item { text-align: center; }\n    .stat-val { display: block; font-weight: bold; color: var(--secondary-color); }\n    .stat-lbl { font-size: 0.7rem; color: #888; }\n    \n    .skill-section { font-size: 0.85rem; background: rgba(0,0,0,0.2); padding: 8px; border-radius: 4px; border-left: 3px solid var(--accent-color); }\n    .skill-title { font-weight: bold; margin-bottom: 3px; }\n    .skill-desc { color: #ccc; font-size: 0.8rem; }\n    \n    .equip-slots { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 5px; }\n    .equip-slot {\n      height: 50px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 4px;\n      display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; position: relative;\n    }\n    .equip-slot:hover { border-color: var(--secondary-color); background: rgba(255,255,255,0.1); }\n    .equip-slot.equipped { border-color: var(--success-color); background: rgba(46,204,113,0.1); }\n    .slot-icon { font-size: 1.2rem; }\n    .slot-label { font-size: 0.6rem; color: #aaa; position: absolute; bottom: 2px; }\n\n    .gd-actions { display: flex; gap: 8px; margin-top: auto; }\n    .action-btn { flex: 1; padding: 6px; }\n\n    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); z-index: 1000; display: flex; align-items: center; justify-content: center; }\n    .modal { background: var(--bg-medium); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; width: 90%; max-width: 500px; max-height: 80vh; display: flex; flex-direction: column; }\n    .modal-header { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; }\n    .close-btn { background: none; border: none; font-size: 1.5rem; color: #fff; cursor: pointer; }\n    .modal-body { padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }\n    .equip-item { padding: 10px; background: rgba(255,255,255,0.05); border-radius: 4px; display: flex; align-items: center; gap: 10px; cursor: pointer; }\n    .equip-item:hover { border-color: var(--secondary-color); background: rgba(255,255,255,0.1); }\n\n    .toast { position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); padding: 12px 28px; background: #333; color: #fff; border-radius: 20px; opacity: 0; transition: opacity 0.3s; pointer-events: none; }\n    .toast.show { opacity: 1; }\n    .toast.success { background: var(--success-color); }\n    .toast.error { background: var(--danger-color); }\n  `;\n  document.head.appendChild(style);\n\n  loadAll();\n\n  async function loadAll() {\n    try {\n      const [generalsRes, equipRes, playerRes] = await Promise.all([\n        hallAPI.getGenerals(userId),\n        hallAPI.getEquipments(userId),\n        playerAPI.getInfo(userId),\n      ]);\n\n      if (playerRes.code === 200 && playerRes.data) {\n        document.getElementById('gold-display').textContent = (playerRes.data.gold || 0).toLocaleString();\n      }\n\n      if (equipRes.code === 200) allEquipments = equipRes.data || [];\n\n      const contentEl = document.getElementById('generals-content');\n      if (generalsRes.code === 200 && generalsRes.data && generalsRes.data.length > 0) {\n        renderGenerals(generalsRes.data, contentEl);\n      } else {\n        contentEl.innerHTML = '<p style=\"text-align:center;width:100%;\">æš‚æ— æ­¦å°†</p>';\n      }\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  function renderGenerals(generals, contentEl) {\n    contentEl.innerHTML = generals.map(g => {\n      const slotsHtml = SLOT_CONFIG.map(slot => {\n        const eq = allEquipments.find(e => e.generalId === g.id && e.slot === slot.key);\n        return `\n              <div class=\"equip-slot ${eq ? 'equipped' : ''}\" data-slot=\"${slot.key}\" data-id=\"${g.id}\">\n                 <div class=\"slot-icon\">${eq ? slot.icon : '+'}</div>\n                 <div class=\"slot-label\">${slot.label}</div>\n              </div>\n            `;\n      }).join('');\n\n      return `\n          <div class=\"general-detail-card ${g.activated ? '' : 'inactive'}\">\n            <div class=\"gd-top\">\n               <div class=\"gd-avatar\">ğŸ–ï¸</div>\n               <div class=\"gd-info\">\n                 <div class=\"gd-name\">${g.name || 'æ­¦å°†'} #${g.templateId}</div>\n                 <div class=\"gd-meta\">\n                   <span>Lv.${g.level}</span> Â· <span>é˜¶ ${g.tier}</span> Â· <span>${g.activated ? 'å·²æ¿€æ´»' : 'æœªæ¿€æ´»'}</span>\n                 </div>\n               </div>\n            </div>\n            \n            <div class=\"stats-row\">\n               <div class=\"stat-item\"><span class=\"stat-val\">${g.currentHp}/${g.maxHp}</span><span class=\"stat-lbl\">HP</span></div>\n               <div class=\"stat-item\"><span class=\"stat-val\">${g.atk || 0}</span><span class=\"stat-lbl\">æ”»å‡»</span></div>\n               <div class=\"stat-item\"><span class=\"stat-val\">${g.speed || 0}</span><span class=\"stat-lbl\">é€Ÿåº¦</span></div>\n               <div class=\"stat-item\"><span class=\"stat-val\">${g.capacity || 0}</span><span class=\"stat-lbl\">ç»Ÿç‡</span></div>\n            </div>\n\n            <div class=\"skill-section\">\n               <div class=\"skill-title\">ğŸ’¡ æŠ€èƒ½: ${g.skillName || 'æ— '}</div>\n               <div class=\"skill-desc\">${g.skillDesc || 'æš‚æ— æ•ˆæœ'}</div>\n            </div>\n\n            <div class=\"equip-slots\">\n                ${g.activated ? slotsHtml : '<div style=\"grid-column:1/-1;text-align:center;font-size:0.8rem;padding:10px;\">éœ€æ¿€æ´»åæ‰å¯ç©¿æˆ´è£…å¤‡</div>'}\n            </div>\n\n            <div class=\"gd-actions\">\n               ${!g.activated && g.unlocked ? `<button class=\"btn btn-primary action-btn\" data-action=\"activate\" data-id=\"${g.id}\">æ¿€æ´»</button>` : ''}\n               ${g.activated ? `<button class=\"btn btn-primary action-btn\" data-action=\"upgrade\" data-id=\"${g.id}\">å‡çº§</button>` : ''}\n               ${g.activated ? `<button class=\"btn btn-secondary action-btn\" data-action=\"ascend\" data-id=\"${g.id}\">å‡é˜¶</button>` : ''}\n            </div>\n          </div>\n        `;\n    }).join('');\n\n    contentEl.querySelectorAll('.action-btn').forEach(btn =>\n      btn.addEventListener('click', () => handleAction(btn.dataset.action, btn.dataset.id)));\n\n    contentEl.querySelectorAll('.equip-slot').forEach(slot =>\n      slot.addEventListener('click', () => openEquipModal(slot.dataset.id, slot.dataset.slot)));\n  }\n\n  function openEquipModal(gId, sKey) {\n    currentGeneralId = parseInt(gId);\n    currentSlotKey = sKey;\n    const list = document.getElementById('equip-list');\n\n    // Filter for slot match\n    const available = allEquipments.filter(e => e.slot === sKey && (!e.generalId || e.generalId === currentGeneralId));\n\n    const content = available.length ? available.map(e => `\n        <div class=\"equip-item\" data-id=\"${e.id}\">\n           <div style=\"font-size:1.5rem\">${SLOT_CONFIG.find(s => s.key === sKey).icon}</div>\n           <div>\n              <div style=\"font-weight:bold\">${e.name} +${e.enhanceLevel}</div>\n              <div style=\"font-size:0.8rem;color:#888;\">${e.generalId === currentGeneralId ? 'å½“å‰è£…å¤‡' : (e.generalId ? 'ä»–äººè£…å¤‡' : 'é—²ç½®')}</div>\n           </div>\n        </div>\n      `).join('') : '<p style=\"text-align:center;color:#888;\">æš‚æ— å¯ç”¨è£…å¤‡</p>';\n\n    list.innerHTML = content;\n    list.querySelectorAll('.equip-item').forEach(it => it.addEventListener('click', () => equip(it.dataset.id)));\n\n    document.getElementById('equip-modal').style.display = 'flex';\n  }\n\n  async function equip(eid) {\n    try {\n      const res = await hallAPI.equipGeneral(userId, currentGeneralId, eid);\n      if (res.code === 200) { showToast('è£…å¤‡æˆåŠŸ'); document.getElementById('equip-modal').style.display = 'none'; loadAll(); }\n      else showToast(res.message, 'error');\n    } catch (e) { showToast(e.message, 'error'); }\n  }\n\n  async function handleAction(action, id) {\n    try {\n      let p;\n      if (action === 'activate') p = hallAPI.activateGeneral(userId, id);\n      if (action === 'upgrade') p = hallAPI.upgradeGeneral(userId, id);\n      if (action === 'ascend') p = hallAPI.ascendGeneral(userId, id);\n      const res = await p;\n      if (res.code === 200) { showToast('æ“ä½œæˆåŠŸ'); loadAll(); }\n      else showToast(res.message, 'error');\n    } catch (e) { showToast(e.message, 'error'); }\n  }\n\n  document.getElementById('close-modal').addEventListener('click', () => document.getElementById('equip-modal').style.display = 'none');\n  document.getElementById('back-btn').addEventListener('click', () => router.navigate('/hall'));\n\n  function showToast(msg, type = 'success') {\n    const toast = document.getElementById('toast');\n    toast.textContent = msg;\n    toast.className = `toast ${type} show`;\n    setTimeout(() => { toast.className = 'toast'; }, 2000);\n  }\n}\n","import { hallAPI, playerAPI } from '../api/index.js';\nimport { router } from '../utils/router.js';\n\nexport function StageSelectionPage(container) {\n  const userId = localStorage.getItem('userId');\n  if (!userId) { router.navigate('/login'); return; }\n\n  container.innerHTML = `\n    <div class=\"stage-page\">\n      <nav class=\"page-nav\">\n        <button class=\"btn btn-secondary btn-sm\" id=\"back-btn\">â† è¿”å›å¤§å…</button>\n        <h1 class=\"page-title\">ğŸ—ºï¸ å¾æˆ˜å››æ–¹</h1>\n        <div class=\"nav-gold\">ğŸ’° <span id=\"gold-display\">--</span></div>\n      </nav>\n\n      <div class=\"stage-content\">\n        <!-- é˜µè¥åˆ‡æ¢ Tab -->\n        <div class=\"civ-tabs\" id=\"civ-tabs\">\n          <button class=\"civ-tab active\" data-civ=\"CN\">ğŸ‡¨ğŸ‡³ ä¸­å›½</button>\n          <button class=\"civ-tab\" data-civ=\"JP\">ğŸ‡¯ğŸ‡µ æ—¥æœ¬</button>\n          <button class=\"civ-tab\" data-civ=\"KR\">ğŸ‡°ğŸ‡· éŸ©å›½</button>\n          <button class=\"civ-tab\" data-civ=\"GB\">ğŸ‡¬ğŸ‡§ è‹±å›½</button>\n        </div>\n\n        <!-- å…³å¡åˆ—è¡¨å®¹å™¨ -->\n        <div class=\"stage-grid\" id=\"stage-grid\">\n          <div class=\"spinner\"></div>\n        </div>\n      </div>\n\n      <div class=\"toast\" id=\"toast\"></div>\n    </div>\n  `;\n\n  const style = document.createElement('style');\n  style.id = 'stage-page-style';\n  document.getElementById('stage-page-style')?.remove();\n  style.textContent = `\n    .stage-page {\n      min-height: 100vh;\n      background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-medium) 100%);\n    }\n    .page-nav {\n      background: rgba(0,0,0,0.3); backdrop-filter: blur(10px);\n      padding: var(--spacing-md) var(--spacing-lg);\n      display: flex; align-items: center; gap: var(--spacing-lg);\n      border-bottom: 2px solid rgba(255,255,255,0.1);\n      position: sticky; top: 0; z-index: 100;\n    }\n    .page-title {\n      flex: 1; font-size: 1.3rem;\n      background: linear-gradient(135deg, var(--primary-color), var(--accent-color));\n      -webkit-background-clip: text; -webkit-text-fill-color: transparent;\n    }\n    .nav-gold { font-weight: bold; font-size: 1.1rem; }\n    .btn-sm { padding: 6px 14px; font-size: 0.85rem; }\n\n    .stage-content {\n      max-width: 1000px; margin: 0 auto; padding: var(--spacing-xl);\n      display: flex; flex-direction: column; gap: var(--spacing-lg);\n    }\n\n    .civ-tabs {\n      display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px;\n    }\n    .civ-tab {\n      flex: 1;\n      padding: 12px;\n      background: rgba(255,255,255,0.05);\n      border: 1px solid rgba(255,255,255,0.1);\n      border-radius: var(--radius-md);\n      color: var(--text-secondary);\n      font-weight: bold; cursor: pointer;\n      transition: all 0.2s ease;\n    }\n    .civ-tab:hover { background: rgba(255,255,255,0.1); }\n    .civ-tab.active {\n      background: rgba(78, 205, 196, 0.15);\n      border-color: var(--secondary-color);\n      color: var(--secondary-color);\n      box-shadow: 0 0 10px rgba(78, 205, 196, 0.2);\n    }\n\n    .stage-grid {\n      display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n      gap: 20px;\n    }\n\n    .stage-card {\n      position: relative;\n      background: rgba(255,255,255,0.03);\n      border: 2px solid rgba(255,255,255,0.08);\n      border-radius: var(--radius-lg);\n      padding: 20px;\n      text-align: center;\n      transition: all 0.3s ease;\n      cursor: pointer;\n      overflow: hidden;\n    }\n    \n    .stage-card:hover { transform: translateY(-3px); }\n\n    /* è§£é”çŠ¶æ€ */\n    .stage-card.unlocked {\n      border-color: rgba(255,255,255,0.3);\n      background: rgba(255,255,255,0.08);\n    }\n    .stage-card.unlocked:hover {\n      border-color: var(--primary-color);\n      box-shadow: 0 5px 15px rgba(255, 107, 53, 0.2);\n    }\n\n    /* å·²é€šå…³çŠ¶æ€ */\n    .stage-card.cleared {\n      border-color: var(--success-color);\n      background: rgba(46, 204, 113, 0.1);\n    }\n    .stage-card.cleared::after {\n      content: 'âœ…'; position: absolute; top: 5px; right: 5px; font-size: 1.2rem;\n    }\n\n    /* é”å®šçŠ¶æ€ */\n    .stage-card.locked {\n      opacity: 0.5; cursor: not-allowed;\n      border-style: dashed;\n    }\n\n    .stage-num {\n      font-size: 2.5rem; font-weight: bold; opacity: 0.2;\n      position: absolute; bottom: -5px; right: 10px;\n      line-height: 1; pointer-events: none;\n    }\n\n    .stage-name {\n      font-size: 1.2rem; font-weight: bold; margin-bottom: 8px; z-index: 1; position: relative;\n    }\n    .stage-desc {\n      font-size: 0.85rem; color: var(--text-secondary); z-index: 1; position: relative;\n    }\n\n    .lock-icon { font-size: 2rem; margin-bottom: 10px; }\n\n    .toast {\n      position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%);\n      padding: 12px 28px; border-radius: var(--radius-lg);\n      font-weight: bold; font-size: 0.95rem;\n      opacity: 0; pointer-events: none;\n      transition: opacity 0.3s ease, transform 0.3s ease; z-index: 999;\n    }\n    .toast.show { opacity: 1; transform: translateX(-50%) translateY(-10px); }\n  `;\n  document.head.appendChild(style);\n\n  // --- çŠ¶æ€ ---\n  let currentCiv = 'CN';\n  let progressData = []; // å­˜å‚¨åç«¯è¿”å›çš„è¿›åº¦ List\n\n  // --- åˆå§‹åŒ– ---\n  init();\n\n  async function init() {\n    // ç»‘å®š Tab ç‚¹å‡»\n    document.querySelectorAll('.civ-tab').forEach(btn => {\n      btn.addEventListener('click', () => {\n        document.querySelectorAll('.civ-tab').forEach(b => b.classList.remove('active'));\n        btn.classList.add('active');\n        currentCiv = btn.dataset.civ;\n        renderStages();\n      });\n    });\n\n    document.getElementById('back-btn').addEventListener('click', () => {\n      router.navigate('/hall');\n    });\n\n    // åŠ è½½æ•°æ®\n    try {\n      const [progRes, playerRes] = await Promise.all([\n        hallAPI.getProgress(userId),\n        playerAPI.getInfo(userId)\n      ]);\n\n      if (playerRes.code === 200 && playerRes.data) {\n        document.getElementById('gold-display').textContent = (playerRes.data.gold || 0).toLocaleString();\n      }\n\n      if (progRes.code === 200 && progRes.data) {\n        progressData = progRes.data;\n        renderStages();\n      }\n    } catch (e) {\n      console.error('åŠ è½½å¤±è´¥', e);\n      document.getElementById('stage-grid').innerHTML = '<p>åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</p>';\n    }\n  }\n\n  function renderStages() {\n    const grid = document.getElementById('stage-grid');\n    grid.innerHTML = '';\n\n    // æ‰¾åˆ°å½“å‰é˜µè¥çš„è¿›åº¦\n    const civProg = progressData.find(p => p.civ === currentCiv);\n\n    if (!civProg || !civProg.unlocked) {\n      grid.innerHTML = `\n        <div style=\"grid-column:1/-1; text-align:center; padding: 40px;\">\n          <h2>ğŸ”’ è¯¥åŠ¿åŠ›å°šæœªè§£é”</h2>\n          <p style=\"color:var(--text-secondary)\">è¯·å…ˆé€šå…³å‰ç½®åŠ¿åŠ›çš„ä¸»çº¿å…³å¡</p>\n        </div>\n      `;\n      return;\n    }\n\n    // å‡è®¾æ¯ä¸ªé˜µè¥ 10 å…³\n    const totalStages = 10;\n    const cleared = civProg.maxStageCleared || 0;\n\n    for (let i = 1; i <= totalStages; i++) {\n      const isCleared = i <= cleared;\n      const isUnlocked = i <= cleared + 1; // ä¸‹ä¸€å…³è§£é”\n\n      const card = document.createElement('div');\n      card.className = `stage-card ${isCleared ? 'cleared' : ''} ${isUnlocked ? 'unlocked' : 'locked'}`;\n\n      // å…³å¡ç±»å‹åˆ¤æ–­ (ç®€å•é€»è¾‘ï¼š5æ˜¯åŸå¢™ï¼Œ10æ˜¯BOSS)\n      let typeText = 'æ™®é€š';\n      if (i === 5 || i === 9) typeText = 'ğŸ° æ”»åŸ';\n      if (i === 10) typeText = 'ğŸ‘¹ BOSS';\n\n      card.innerHTML = `\n        ${!isUnlocked ? '<div class=\"lock-icon\">ğŸ”’</div>' : ''}\n        <div class=\"stage-name\">ç¬¬ ${i} å…³</div>\n        <div class=\"stage-desc\">${typeText}</div>\n        <div class=\"stage-num\">${i}</div>\n      `;\n\n      if (isUnlocked) {\n        card.addEventListener('click', () => {\n          // è¿™é‡Œä»¥åè·³è½¬åˆ°æˆ˜æ–—å‡†å¤‡é¡µï¼Œç°åœ¨å…ˆå¼¹ä¸ªæç¤º\n          // router.navigate(`/battle/prepare?civ=${currentCiv}&stage=${i}`);\n          enterBattlePrepare(currentCiv, i);\n        });\n      }\n\n      grid.appendChild(card);\n    }\n  }\n\n  function enterBattlePrepare(civ, stage) {\n    // è·³è½¬åˆ°æˆ˜å‰é…å…µé¡µ\n    router.navigate('/battle/prepare', { civ, stageNo: stage });\n  }\n}\n","import { hallAPI, playerAPI } from '../api/index.js';\nimport { router } from '../utils/router.js';\nimport { getEquipmentSlotIcon, getEquipmentSlotLabel } from '../config/gameData.js';\n\nexport function EquipmentPage(container) {\n  const userId = localStorage.getItem('userId');\n  if (!userId) { router.navigate('/login'); return; }\n\n  container.innerHTML = `\n    <div class=\"equipment-page\">\n      <nav class=\"page-nav\">\n        <button class=\"btn btn-secondary btn-sm\" id=\"back-btn\">â† è¿”å›å¤§å…</button>\n        <h1 class=\"page-title\">âš’ï¸ è£…å¤‡å¼ºåŒ–</h1>\n        <div class=\"nav-gold\">ğŸ’° <span id=\"gold-display\">--</span></div>\n      </nav>\n\n      <div class=\"equip-content\" id=\"equip-list\">\n        <div class=\"spinner\"></div>\n      </div>\n      \n      <div class=\"toast\" id=\"toast\"></div>\n    </div>\n  `;\n\n  const style = `\n    .equipment-page {\n      min-height: 100vh;\n      background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-medium) 100%);\n    }\n    .page-nav {\n      background: rgba(0,0,0,0.3); backdrop-filter: blur(10px);\n      padding: var(--spacing-md) var(--spacing-lg);\n      display: flex; align-items: center; gap: var(--spacing-lg);\n      border-bottom: 2px solid rgba(255,255,255,0.1);\n      position: sticky; top: 0; z-index: 100;\n    }\n    .page-title { flex: 1; font-size: 1.3rem; background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }\n    .nav-gold { font-weight: bold; font-size: 1.1rem; }\n    .btn-sm { padding: 6px 14px; font-size: 0.85rem; }\n\n    .equip-content {\n      max-width: 800px; margin: 0 auto; padding: var(--spacing-xl);\n      display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));\n      gap: var(--spacing-lg);\n    }\n    \n    .equip-card {\n      background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1);\n      border-radius: var(--radius-md); padding: 15px;\n      display: flex; flex-direction: column; gap: 10px;\n      transition: all 0.3s;\n    }\n    .equip-card:hover { border-color: var(--secondary-color); transform: translateY(-3px); }\n    \n    .ec-top { display: flex; align-items: center; gap: 10px; }\n    .ec-icon { width: 48px; height: 48px; background: rgba(0,0,0,0.3); border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }\n    .ec-info { flex: 1; }\n    .ec-name { font-weight: bold; }\n    .ec-lv { font-size: 0.8rem; color: var(--secondary-color); }\n    \n    .ec-stat { font-size: 0.85rem; color: var(--text-secondary); }\n    .enhance-btn { margin-top: auto; width: 100%; }\n\n    .toast {\n      position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%);\n      padding: 12px 28px; border-radius: var(--radius-lg);\n      font-weight: bold; font-size: 0.95rem;\n      opacity: 0; pointer-events: none;\n      transition: opacity 0.3s ease, transform 0.3s ease; z-index: 999;\n    }\n    .toast.show { opacity: 1; transform: translateX(-50%) translateY(-10px); }\n    .toast.success { background: var(--success-color); color: #fff; }\n    .toast.error { background: var(--danger-color); color: #fff; }\n  `;\n\n  const styleEl = document.createElement('style');\n  styleEl.id = 'equipment-page-style';\n  document.getElementById('equipment-page-style')?.remove();\n  styleEl.textContent = style;\n  document.head.appendChild(styleEl);\n\n  loadData();\n\n  async function loadData() {\n    try {\n      const [equipRes, playerRes] = await Promise.all([\n        hallAPI.getEquipments(userId),\n        playerAPI.getInfo(userId)\n      ]);\n\n      if (playerRes.code === 200 && playerRes.data) {\n        document.getElementById('gold-display').textContent = (playerRes.data.gold || 0).toLocaleString();\n      }\n\n      const list = document.getElementById('equip-list');\n      if (equipRes.code === 200 && equipRes.data && equipRes.data.length > 0) {\n        list.innerHTML = equipRes.data.map(e => {\n          const lv = e.enhanceLevel || 0;\n          const cost = (lv + 1) * 100;\n          const name = e.name || `è£…å¤‡#${e.templateId}`;\n          const icon = getEquipmentSlotIcon(e.slot);\n          const slotName = getEquipmentSlotLabel(e.slot);\n\n          return `\n           <div class=\"equip-card\">\n             <div class=\"ec-top\">\n               <div class=\"ec-icon\">${icon}</div>\n               <div class=\"ec-info\">\n                 <div class=\"ec-name\">${name} <span class=\"ec-lv\">+${lv}</span></div>\n                 <div class=\"ec-stat\">${slotName} Â· ${e.generalId ? 'å·²ç©¿æˆ´' : 'é—²ç½®'}</div>\n               </div>\n             </div>\n             <div class=\"ec-stat\">åŸºç¡€å±æ€§: ATK ${e.baseAtk || 0} / HP ${e.baseHp || 0} / SPD ${e.baseSpd || 0}</div>\n             <div class=\"ec-stat\">æ¶ˆè€—: ${cost}é‡‘å¸</div>\n             <button class=\"btn btn-primary enhance-btn\" data-id=\"${e.id}\" data-cost=\"${cost}\">å¼ºåŒ–</button>\n           </div>\n           `;\n        }).join('');\n\n        list.querySelectorAll('.enhance-btn').forEach(btn => {\n          btn.addEventListener('click', () => enhance(btn.dataset.id, btn.dataset.cost));\n        });\n      } else {\n        list.innerHTML = '<p style=\"text-align:center;grid-column:1/-1;\">æš‚æ— è£…å¤‡</p>';\n      }\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  async function enhance(id, cost) {\n    if (!confirm(`ç¡®è®¤æ¶ˆè€— ${cost} é‡‘å¸å¼ºåŒ–è£…å¤‡å—ï¼Ÿ\\n(+3ä»¥ä¸Šå¯èƒ½ä¼šå¤±è´¥æ‰çº§)`)) return;\n    try {\n      const res = await hallAPI.enhanceEquipment(userId, id);\n      if (res.code === 200) {\n        // åç«¯ç°åœ¨è¿”å›å…·ä½“çš„æ¶ˆæ¯ï¼ˆæˆåŠŸæˆ–å¤±è´¥æ‰çº§ï¼‰\n        const msg = res.data;\n        const isFail = msg.includes(\"å¤±è´¥\");\n        showToast(msg, isFail ? 'error' : 'success');\n        loadData();\n      } else {\n        showToast(res.message || 'å¼ºåŒ–å¤±è´¥', 'error');\n      }\n    } catch (e) {\n      showToast(e.message || 'æ“ä½œå¤±è´¥', 'error');\n    }\n  }\n\n  function showToast(msg, type = 'success') {\n    const toast = document.getElementById('toast');\n    toast.textContent = msg;\n    toast.className = `toast ${type} show`;\n    setTimeout(() => { toast.className = 'toast'; }, 2000);\n  }\n\n  document.getElementById('back-btn').addEventListener('click', () => router.navigate('/hall'));\n}\n","import { hallAPI, playerAPI } from '../api/index.js';\nimport { router } from '../utils/router.js';\n\nexport function GemPage(container) {\n  const userId = localStorage.getItem('userId');\n  if (!userId) { router.navigate('/login'); return; }\n\n  let allGems = []; // Store raw gem data\n\n  container.innerHTML = `\n    <div class=\"gem-page\">\n      <nav class=\"page-nav\">\n        <button class=\"btn btn-secondary btn-sm\" id=\"back-btn\">â† è¿”å›å¤§å…</button>\n        <h1 class=\"page-title\">ğŸ’ å®çŸ³å·¥åŠ</h1>\n        <div class=\"nav-gold\">ğŸ’° <span id=\"gold-display\">--</span></div>\n      </nav>\n\n      <div class=\"gem-content\">\n        <!-- å®çŸ³åˆæˆ -->\n        <div class=\"section-card card\">\n          <h3>ğŸ“¦ å®çŸ³èƒŒåŒ… (5åˆ1)</h3>\n          <div class=\"gem-list\" id=\"gem-list\">\n            <div class=\"spinner\"></div>\n          </div>\n        </div>\n\n        <!-- å®çŸ³é•¶åµŒ -->\n        <div class=\"section-card card\">\n          <h3>âš’ï¸ è£…å¤‡é•¶åµŒ</h3>\n          <div class=\"equip-list\" id=\"equip-list\">\n            <div class=\"spinner\"></div>\n          </div>\n        </div>\n      </div>\n\n      <!-- å®çŸ³é€‰æ‹©æ¨¡æ€æ¡† -->\n      <div class=\"modal-overlay\" id=\"gem-select-modal\" style=\"display:none;\">\n        <div class=\"modal\">\n          <div class=\"modal-header\">\n            <h3>é€‰æ‹©å®çŸ³</h3>\n            <button class=\"close-btn\" id=\"close-modal\">Ã—</button>\n          </div>\n          <div class=\"modal-body\" id=\"select-gem-list\">\n            <!-- Render gems here -->\n          </div>\n        </div>\n      </div>\n\n      <div class=\"toast\" id=\"toast\"></div>\n    </div>\n  `;\n\n  // Styles...\n  // å¤ç”¨ä¹‹å‰çš„æ ·å¼ï¼Œå¢åŠ  modal æ ·å¼\n  const style = document.createElement('style');\n  style.id = 'gem-page-style';\n  document.getElementById('gem-page-style')?.remove();\n  style.textContent = `\n    .gem-page { min-height: 100vh; background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-medium) 100%); }\n    .page-nav { background: rgba(0,0,0,0.3); backdrop-filter: blur(10px); padding: 15px 20px; display: flex; align-items: center; gap: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); position: sticky; top: 0; z-index: 100; }\n    .page-title { flex: 1; font-size: 1.3rem; background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; }\n    .nav-gold { font-weight: bold; }\n    \n    .gem-content { max-width: 1000px; margin: 0 auto; padding: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }\n    @media(max-width: 768px) { .gem-content { grid-template-columns: 1fr; } }\n    \n    .section-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 20px; display: flex; flex-direction: column; gap: 15px; }\n    .section-card h3 { border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; margin-bottom: 10px; }\n\n    .gem-item { display: flex; align-items: center; justify-content: space-between; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 4px; margin-bottom: 8px; }\n    .gem-info { display: flex; align-items: center; gap: 10px; }\n    .gem-icon { width: 32px; height: 32px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; }\n    \n    .equip-item { padding: 10px; background: rgba(0,0,0,0.2); border-radius: 4px; margin-bottom: 8px; cursor: pointer; border: 1px solid transparent; }\n    .equip-item:hover { border-color: var(--secondary-color); }\n\n    .btn-sm { padding: 4px 10px; font-size: 0.8rem; }\n    \n    /* Modal */\n    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); z-index: 1000; display: flex; align-items: center; justify-content: center; }\n    .modal { background: var(--bg-medium); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; width: 90%; max-width: 400px; max-height: 80vh; display: flex; flex-direction: column; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }\n    .modal-header { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; }\n    .close-btn { background: none; border: none; font-size: 1.5rem; color: #fff; cursor: pointer; }\n    .modal-body { padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }\n    \n    .select-item { padding: 10px; background: rgba(255,255,255,0.05); border-radius: 4px; cursor: pointer; display: flex; align-items: center; gap: 10px; }\n    .select-item:hover { background: rgba(255,255,255,0.1); }\n\n    .toast { position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); padding: 12px 28px; background: #333; color: #fff; border-radius: 20px; opacity: 0; transition: opacity 0.3s; pointer-events: none; }\n    .toast.show { opacity: 1; }\n    .toast.success { background: var(--success-color); }\n    .toast.error { background: var(--danger-color); }\n  `;\n  document.head.appendChild(style);\n\n  // Load Data\n  loadData();\n\n  async function loadData() {\n    try {\n      const [gemRes, equipRes, playerRes] = await Promise.all([\n        hallAPI.getGems(userId),\n        hallAPI.getEquipments(userId),\n        playerAPI.getInfo(userId)\n      ]);\n\n      if (playerRes.code === 200 && playerRes.data) {\n        document.getElementById('gold-display').textContent = (playerRes.data.gold || 0).toLocaleString();\n      }\n\n      if (gemRes.code === 200) allGems = gemRes.data || [];\n\n      // æ¸²æŸ“å®çŸ³ (åˆæˆ)\n      const gemList = document.getElementById('gem-list');\n      const groups = {};\n      allGems.forEach(g => {\n        if (g.isUsed) return;\n        const key = `${g.gemType}-${g.gemLevel}`;\n        if (!groups[key]) groups[key] = { type: g.gemType, level: g.gemLevel, count: 0, ids: [] };\n        groups[key].count++;\n        groups[key].ids.push(g.id);\n      });\n\n      if (Object.keys(groups).length === 0) {\n        gemList.innerHTML = '<p style=\"text-align:center;color:#888\">æš‚æ— é—²ç½®å®çŸ³</p>';\n      } else {\n        gemList.innerHTML = Object.values(groups).map(grp => `\n          <div class=\"gem-item\">\n            <div class=\"gem-info\">\n              <div class=\"gem-icon\">ğŸ’</div>\n              <div>\n                <div>${grp.type} Lv.${grp.level}</div>\n                <div style=\"font-size:0.8rem;color:#888\">æ‹¥æœ‰: ${grp.count}</div>\n              </div>\n            </div>\n            ${grp.count >= 5 ? `<button class=\"btn btn-primary btn-sm combine-btn\" data-type=\"${grp.type}\" data-level=\"${grp.level}\">åˆæˆ</button>` : ''}\n          </div>\n        `).join('');\n\n        gemList.querySelectorAll('.combine-btn').forEach(btn => {\n          btn.addEventListener('click', () => combine(btn.dataset.type, btn.dataset.level));\n        });\n      }\n\n      // æ¸²æŸ“è£…å¤‡ (é•¶åµŒ)\n      const equipList = document.getElementById('equip-list');\n      if (equipRes.code === 200 && equipRes.data) {\n        equipList.innerHTML = equipRes.data.map(e => `\n          <div class=\"equip-item\" data-id=\"${e.id}\">\n             <div style=\"font-weight:bold\">${e.name || ('è£…å¤‡#' + e.templateId)} +${e.enhanceLevel || 0}</div>\n             <div style=\"font-size:0.8rem;color:#888; margin-top:5px;\">\n               <span class=\"socket-span\" data-eid=\"${e.id}\" data-idx=\"1\" style=\"background:${e.socket1GemId ? 'rgba(46,204,113,0.2)' : 'rgba(255,255,255,0.1)'};padding:2px 6px;border-radius:4px;cursor:pointer;\">\n                 å­”1: ${e.socket1GemId ? 'å·²é•¶åµŒ' : '+ ç©º'}\n               </span>\n               <span class=\"socket-span\" data-eid=\"${e.id}\" data-idx=\"2\" style=\"background:${e.socket2GemId ? 'rgba(46,204,113,0.2)' : 'rgba(255,255,255,0.1)'};padding:2px 6px;border-radius:4px;cursor:pointer;margin-left:5px;\">\n                 å­”2: ${e.socket2GemId ? 'å·²é•¶åµŒ' : '+ ç©º'}\n               </span>\n             </div>\n          </div>\n        `).join('');\n\n        // ç»‘å®šå­”ä½ç‚¹å‡»\n        equipList.querySelectorAll('.socket-span').forEach(span => {\n          span.addEventListener('click', (ev) => {\n            ev.stopPropagation();\n            // æ£€æŸ¥æ˜¯å¦å·²æœ‰å®çŸ³\n            if (span.textContent.includes('å·²é•¶åµŒ')) {\n              showToast('ç”±äºæ—¶é—´é™åˆ¶ï¼Œæš‚ä¸æ”¯æŒæ‹†å¸å®çŸ³', 'error');\n            } else {\n              openUseGemModal(span.dataset.eid, span.dataset.idx);\n            }\n          });\n        });\n      }\n\n    } catch (e) { console.error(e); }\n  }\n\n  // æ‰“å¼€é€‰æ‹©å®çŸ³å¼¹çª—\n  let currentEquipId = null;\n  let currentSocketIdx = null;\n\n  function openUseGemModal(equipId, socketIdx) {\n    currentEquipId = equipId;\n    currentSocketIdx = socketIdx;\n\n    // è¿‡æ»¤å¯ç”¨é—²ç½®å®çŸ³\n    const unusedGems = allGems.filter(g => !g.isUsed);\n    const list = document.getElementById('select-gem-list');\n\n    if (unusedGems.length === 0) {\n      list.innerHTML = '<p style=\"text-align:center;color:#888\">æ²¡æœ‰é—²ç½®å®çŸ³</p>';\n    } else {\n      list.innerHTML = unusedGems.map(g => `\n        <div class=\"select-item\" data-gid=\"${g.id}\">\n          <div class=\"gem-icon\" style=\"width:24px;height:24px;font-size:0.8rem;\">ğŸ’</div>\n          <div>${g.gemType} Lv.${g.gemLevel}</div>\n          <div style=\"margin-left:auto;font-size:0.8rem;color:#aaa;\">+${g.statValue}</div>\n        </div>\n      `).join('');\n\n      list.querySelectorAll('.select-item').forEach(item => {\n        item.addEventListener('click', () => {\n          inlayGem(item.dataset.gid);\n        });\n      });\n    }\n\n    document.getElementById('gem-select-modal').style.display = 'flex';\n  }\n\n  async function inlayGem(gemId) {\n    try {\n      const res = await hallAPI.inlayGem(userId, currentEquipId, parseInt(currentSocketIdx), gemId);\n      if (res.code === 200) {\n        showToast('é•¶åµŒæˆåŠŸï¼');\n        document.getElementById('gem-select-modal').style.display = 'none';\n        loadData();\n      } else {\n        showToast(res.message || 'é•¶åµŒå¤±è´¥', 'error');\n      }\n    } catch (e) {\n      showToast(e.message, 'error');\n    }\n  }\n\n  document.getElementById('close-modal').addEventListener('click', () => {\n    document.getElementById('gem-select-modal').style.display = 'none';\n  });\n\n  async function combine(type, level) {\n    try {\n      const res = await hallAPI.combineGem(userId, type, parseInt(level));\n      if (res.code === 200) {\n        showToast('åˆæˆæˆåŠŸï¼');\n        loadData();\n      } else {\n        showToast(res.message, 'error');\n      }\n    } catch (e) {\n      showToast(e.message, 'error');\n    }\n  }\n\n  function showToast(msg, type = 'success') {\n    const toast = document.getElementById('toast');\n    toast.textContent = msg;\n    toast.className = `toast ${type} show`;\n    setTimeout(() => { toast.className = 'toast'; }, 2000);\n  }\n\n  document.getElementById('back-btn').addEventListener('click', () => router.navigate('/hall'));\n}\n","\nimport { hallAPI, playerAPI } from '../api/index.js';\nimport { router } from '../utils/router.js';\nimport { SKILL_BOOK_META } from '../config/gameData.js';\n\nexport function SkillPage(container) {\n    const userId = localStorage.getItem('userId');\n    if (!userId) { router.navigate('/login'); return; }\n\n    container.innerHTML = `\n    <div class=\"skill-page\">\n      <nav class=\"page-nav\">\n        <button class=\"btn btn-secondary btn-sm\" id=\"back-btn\">â† è¿”å›å¤§å…</button>\n        <h1 class=\"page-title\">ğŸ“š æŠ€èƒ½ç ”ä¿®</h1>\n        <div class=\"nav-gold\">ğŸ’° <span id=\"gold-display\">--</span></div>\n      </nav>\n\n      <div class=\"skill-content\">\n        <!-- 1. é€‰æ‹©æ­¦å°† -->\n        <div class=\"section-card card\">\n          <h3>ğŸ‘¤ é€‰æ‹©æ­¦å°†</h3>\n          <div class=\"general-list-h\" id=\"general-list\">\n            <div class=\"spinner\"></div>\n          </div>\n        </div>\n\n        <!-- 2. é€‰æ‹©æŠ€èƒ½ä¹¦ -->\n        <div class=\"section-card card\" id=\"book-section\">\n          <h3>ğŸ“– æŠ€èƒ½ä¹¦èƒŒåŒ…</h3>\n          <div class=\"book-list\" id=\"book-list\">\n            <p style=\"text-align:center;color:#888\">è¯·å…ˆé€‰æ‹©æ­¦å°†</p>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"toast\" id=\"toast\"></div>\n    </div>\n  `;\n\n    // æ ·å¼\n    const style = `\n    /* Common */\n    .skill-page { min-height: 100vh; background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-medium) 100%); }\n    .page-nav { padding: 15px 20px; background: rgba(0,0,0,0.3); border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; gap: 20px; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px); }\n    .page-title { flex: 1; font-size: 1.3rem; font-weight: bold; background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }\n    \n    .skill-content { max-width: 1000px; margin: 0 auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; }\n    .section-card { background: rgba(255,255,255,0.05); border-radius: 8px; padding: 20px; border: 1px solid rgba(255,255,255,0.1); }\n    .section-card h3 { margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px; }\n\n    .general-list-h { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; }\n    .g-card { min-width: 100px; background: rgba(0,0,0,0.2); border-radius: 4px; padding: 10px; text-align: center; cursor: pointer; border: 2px solid transparent; transition: all 0.2s; }\n    .g-card:hover { transform: translateY(-3px); }\n    .g-card.selected { border-color: var(--primary-color); background: rgba(255,107,53,0.1); }\n    .g-av { width: 48px; height: 48px; background: #444; border-radius: 50%; margin: 0 auto 5px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }\n\n    .book-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }\n    .book-card { background: rgba(0,0,0,0.2); border-radius: 4px; padding: 10px; display: flex; align-items: center; gap: 10px; cursor: pointer; border: 1px solid transparent; }\n    .book-card:hover { border-color: var(--secondary-color); }\n    .book-icon { width: 40px; height: 40px; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; border-radius: 4px; font-size: 1.2rem; }\n    \n    .toast { position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); padding: 10px 20px; background: #333; color: #fff; border-radius: 20px; opacity: 0; pointer-events: none; transition: opacity 0.3s; }\n    .toast.show { opacity: 1; }\n    .toast.success { background: var(--success-color); }\n    .toast.error { background: var(--danger-color); }\n  `;\n    const styleEl = document.createElement('style');\n    styleEl.textContent = style;\n    document.head.appendChild(styleEl);\n\n    let selectedGeneralId = null;\n    let generals = [];\n    let items = [];\n\n    loadData();\n\n    async function loadData() {\n        try {\n            const [genRes, itemRes, playerRes] = await Promise.all([\n                hallAPI.getGenerals(userId),\n                hallAPI.getItems(userId),\n                playerAPI.getInfo(userId)\n            ]);\n\n            if (playerRes.code === 200 && playerRes.data) {\n                document.getElementById('gold-display').textContent = (playerRes.data.gold || 0).toLocaleString();\n            }\n\n            generals = (genRes.code === 200) ? genRes.data : [];\n            items = (itemRes.code === 200) ? itemRes.data : [];\n\n            renderGenerals();\n            renderBooks();\n        } catch (e) { console.error(e); }\n    }\n\n    function renderGenerals() {\n        const list = document.getElementById('general-list');\n        if (generals.length === 0) list.innerHTML = '<p>æš‚æ— æ­¦å°†</p>';\n        else {\n            list.innerHTML = generals.map(g => `\n        <div class=\"g-card ${selectedGeneralId == g.id ? 'selected' : ''}\" data-id=\"${g.id}\">\n          <div class=\"g-av\">ğŸ–ï¸</div>\n          <div style=\"font-size:0.9rem;font-weight:bold\">æ­¦å°†#${g.templateId}</div>\n          <div style=\"font-size:0.8rem;color:#ccc\">Lv.${g.level}</div>\n        </div>\n      `).join('');\n\n            list.querySelectorAll('.g-card').forEach(card => {\n                card.addEventListener('click', () => {\n                    selectedGeneralId = card.dataset.id;\n                    renderGenerals(); // refresh selection\n                    renderBooks();\n                });\n            });\n        }\n    }\n\n    function renderBooks() {\n        const list = document.getElementById('book-list');\n        if (!selectedGeneralId) {\n            list.innerHTML = '<p style=\"text-align:center;color:#888;width:100%\">è¯·å…ˆé€‰æ‹©æ­¦å°†</p>';\n            return;\n        }\n\n        // è¿‡æ»¤å‡ºæŠ€èƒ½ä¹¦ (å‡è®¾ itemId >= 300 æ˜¯æŠ€èƒ½ä¹¦ ? æˆ–è€…åªè®¤ 301)\n        // ç®€å•èµ·è§ï¼Œæ‰€æœ‰ item éƒ½æ˜¯æŠ€èƒ½ä¹¦\n        const books = items.filter(i => i.count > 0 && i.itemId >= 300); // Magic number assumption\n\n        if (books.length === 0) {\n            list.innerHTML = '<p style=\"text-align:center;color:#888;width:100%\">èƒŒåŒ…ä¸­æ²¡æœ‰æŠ€èƒ½ä¹¦</p>';\n        } else {\n            list.innerHTML = books.map(b => `\n        <div class=\"book-card\" data-iid=\"${b.itemId}\">\n          <div class=\"book-icon\">ğŸ“š</div>\n          <div>\n            <div style=\"font-weight:bold\">${SKILL_BOOK_META[b.itemId]?.name || ('æŠ€èƒ½ä¹¦ #' + b.itemId)}</div>\n            <div style=\"font-size:0.8rem;color:#888\">æ‹¥æœ‰: ${b.count}</div>\n          </div>\n          <button class=\"btn btn-primary btn-sm learn-btn\" data-iid=\"${b.itemId}\">å­¦ä¹ </button>\n        </div>\n      `).join('');\n\n            list.querySelectorAll('.learn-btn').forEach(btn => {\n                btn.addEventListener('click', () => learn(btn.dataset.iid));\n            });\n        }\n    }\n\n    async function learn(itemId) {\n        if (!confirm('ç¡®è®¤æ¶ˆè€—ä¸€æœ¬æŠ€èƒ½ä¹¦è®©è¯¥æ­¦å°†å­¦ä¹ æŠ€èƒ½å—ï¼Ÿ(æ—§æŠ€èƒ½å°†è¢«è¦†ç›–)')) return;\n        try {\n            const res = await hallAPI.learnSkill(userId, selectedGeneralId, parseInt(itemId));\n            if (res.code === 200) {\n                showToast('å­¦ä¹ æˆåŠŸï¼', 'success');\n                loadData(); // refresh count\n            } else {\n                showToast(res.message || 'å­¦ä¹ å¤±è´¥', 'error');\n            }\n        } catch (e) {\n            showToast(e.message, 'error');\n        }\n    }\n\n    function showToast(msg, type = 'success') {\n        const toast = document.getElementById('toast');\n        toast.textContent = msg;\n        toast.className = `toast ${type} show`;\n        setTimeout(() => { toast.className = 'toast'; }, 2000);\n    }\n\n    document.getElementById('back-btn').addEventListener('click', () => router.navigate('/hall'));\n}\n","import { battleAPI, hallAPI } from '../api/index.js';\nimport { router } from '../utils/router.js';\nimport { getTroopTypeName } from '../config/gameData.js';\n\nexport function BattlePage(container, params) {\n    const userId = localStorage.getItem('userId');\n    if (!userId) { router.navigate('/login'); return; }\n\n    // Params: { civ, stageNo } if starting new battle OR empty if resuming\n    const isNewBattle = !!params.civ;\n\n    // State\n    let battleState = null;\n    let isProcessing = false;\n\n    // UI Structure\n    container.innerHTML = `\n    <div class=\"battle-page\">\n      <div class=\"battle-header\">\n        <div class=\"turn-indicator\">\n            <span id=\"turn-display\">Battle Start</span>\n            <span id=\"phase-display\" style=\"font-size:0.8em; margin-left:10px; background:#444; padding:2px 6px; border-radius:4px;\">INIT</span>\n        </div>\n        <button class=\"btn btn-sm btn-secondary\" id=\"flee-btn\">æ’¤é€€</button>\n      </div>\n      \n      <div class=\"battle-field\">\n        <!-- æˆ‘æ–¹åŒºåŸŸ (Side A) -->\n        <div class=\"battle-side side-a\" id=\"side-a\">\n           <div class=\"hero-card\" id=\"hero-a\">\n              <div class=\"hero-avatar\">ğŸ¤´</div>\n              <div class=\"hero-stats\">\n                 <div class=\"hero-name\">æˆ‘æ–¹ä¸»å…¬</div>\n                 <div class=\"hp-bar\"><div class=\"hp-fill\" style=\"width:100%\"></div></div>\n                 <div class=\"hp-text\">--/--</div>\n              </div>\n           </div>\n           <div class=\"troops-container\" id=\"troops-a\"></div>\n        </div>\n\n        <!-- VS Icon -->\n        <div class=\"vs-divider\">VS</div>\n\n        <!-- æ•Œæ–¹åŒºåŸŸ (Side B) -->\n        <div class=\"battle-side side-b\" id=\"side-b\">\n           <div class=\"hero-card\" id=\"hero-b\">\n              <div class=\"hero-avatar enemy\">ğŸ‘¹</div>\n              <div class=\"hero-stats\">\n                 <div class=\"hero-name\">æ•Œæ–¹é¦–é¢†</div>\n                 <div class=\"hp-bar\"><div class=\"hp-fill\" style=\"width:100%\"></div></div>\n                 <div class=\"hp-text\">--/--</div>\n              </div>\n           </div>\n           <div class=\"troops-container\" id=\"troops-b\"></div>\n        </div>\n      </div>\n\n      <!-- æˆ˜æ–—æ—¥å¿— -->\n      <div class=\"battle-logs\">\n         <div class=\"logs-content\" id=\"logs-content\"></div>\n      </div>\n\n       <!-- æ“ä½œæ  -->\n       <div class=\"action-bar\" id=\"action-bar\" style=\"flex-direction:column;gap:10px;height:auto;padding:10px;\">\n          <div id=\"tactics-ui\" style=\"display:flex;gap:15px;color:#aaa;font-size:0.9rem;\">\n              <span style=\"color:#ffd700\">æˆ˜æœ¯:</span>\n              <label><input type=\"radio\" name=\"tactics\" value=\"DEFAULT\" checked>é»˜è®¤</label>\n              <label><input type=\"radio\" name=\"tactics\" value=\"TARGET_INF\">æ”»æ­¥</label>\n              <label><input type=\"radio\" name=\"tactics\" value=\"TARGET_ARC\">æ”»å¼“</label>\n              <label><input type=\"radio\" name=\"tactics\" value=\"TARGET_CAV\">æ”»éª‘</label>\n          </div>\n          <div class=\"action-status\" id=\"action-status\">æ­£åœ¨åˆå§‹åŒ–...</div>\n          <div class=\"action-buttons\" id=\"action-buttons\" style=\"display:none\">\n             <button class=\"btn btn-primary\" id=\"btn-attack\">âš”ï¸ æ™®é€šæ”»å‡»</button>\n             <button class=\"btn btn-accent\" id=\"btn-skill\">âœ¨ é‡Šæ”¾æŠ€èƒ½</button>\n          </div>\n       </div>\n      \n      <!-- ç»“ç®—å¼¹çª— -->\n      <div class=\"result-modal\" id=\"result-modal\" style=\"display:none\">\n         <div class=\"result-content\">\n            <h2 id=\"result-title\">Victory!</h2>\n            <div id=\"result-desc\">è·å¾—æˆ˜åˆ©å“...</div>\n            <button class=\"btn btn-primary\" id=\"result-ok\">è¿”å›å¤§å…</button>\n         </div>\n      </div>\n    </div>\n  `;\n\n    // Styles\n    const style = document.createElement('style');\n    style.id = 'battle-page-style';\n    document.getElementById('battle-page-style')?.remove();\n    style.textContent = `\n    .battle-page { height: 100vh; display: flex; flex-direction: column; background: #1a1a2e; color: #fff; overflow: hidden; }\n    .battle-header { padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.3); }\n    .turn-indicator { font-size: 1.2rem; font-weight: bold; color: var(--accent-color); }\n    \n    .battle-field { flex: 1; display: flex; padding: 20px; gap: 20px; align-items: center; justify-content: center; position: relative; }\n    .vs-divider { font-size: 3rem; font-weight: 900; color: rgba(255,255,255,0.1); position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); z-index: 0; }\n    \n    .battle-side { flex: 1; display: flex; flex-direction: column; gap: 20px; z-index: 1; max-width: 400px; }\n    .side-a { align-items: flex-start; }\n    .side-b { align-items: flex-end; }\n    \n    .hero-card { \n      display: flex; gap: 15px; padding: 15px; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; width: 100%;\n      align-items: center; transition: all 0.3s;\n    }\n    .side-b .hero-card { flex-direction: row-reverse; text-align: right; border-color: rgba(255, 87, 87, 0.3); }\n    \n    .hero-avatar { width: 60px; height: 60px; border-radius: 50%; background: var(--primary-color); display: flex; align-items: center; justify-content: center; font-size: 2rem; border: 2px solid #fff; }\n    .hero-avatar.enemy { background: var(--danger-color); }\n    \n    .hero-stats { flex: 1; }\n    .hero-name { font-weight: bold; margin-bottom: 5px; }\n    .hp-bar { height: 8px; background: rgba(0,0,0,0.5); border-radius: 4px; overflow: hidden; }\n    .hp-fill { height: 100%; background: var(--success-color); transition: width 0.3s; }\n    .hp-text { font-size: 0.8rem; color: #aaa; margin-top: 2px; }\n    \n    .troops-container { display: flex; flex-direction: column; gap: 10px; width: 100%; }\n    .troop-unit { \n      display: flex; justify-content: space-between; padding: 8px 12px; background: rgba(0,0,0,0.2); border-radius: 6px; \n      font-size: 0.9rem; align-items: center; border-left: 3px solid #666;\n    }\n    .side-b .troop-unit { flex-direction: row-reverse; border-left: none; border-right: 3px solid #666; }\n    \n    .troop-dead { opacity: 0.3; filter: grayscale(100%); }\n    .troop-active { border-color: var(--accent-color); background: rgba(255,215,0,0.1); box-shadow: 0 0 10px rgba(255,215,0,0.2); }\n    \n    .battle-logs { height: 150px; background: rgba(0,0,0,0.5); padding: 10px; overflow-y: auto; font-family: monospace; font-size: 0.85rem; border-top: 1px solid #333; }\n    .log-entry { margin-bottom: 4px; color: #ccc; }\n    .log-highlight { color: var(--accent-color); }\n    .log-dmg { color: var(--danger-color); }\n    \n    .action-bar { height: 80px; background: #222; display: flex; align-items: center; justify-content: center; border-top: 1px solid #444; }\n    .action-status { color: #888; font-size: 1.1rem; animation: pulse 1.5s infinite; }\n    .action-buttons { display: flex; gap: 20px; }\n    .btn-accent { background: var(--accent-color); color: #000; }\n    \n    @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }\n    \n    .result-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); display: flex; align-items: center; justify-content: center; z-index: 1000; }\n    .result-content { background: #333; padding: 40px; border-radius: 12px; text-align: center; min-width: 300px; border: 2px solid var(--accent-color); }\n    #result-title { font-size: 2rem; margin-bottom: 10px; color: var(--accent-color); }\n  `;\n    document.head.appendChild(style);\n\n    // Tactics\n    let currentTactics = \"\";\n    container.querySelectorAll('input[name=\"tactics\"]').forEach(input => {\n        input.addEventListener('change', (e) => currentTactics = e.target.value);\n    });\n\n    // Mod: Only resume battle. New battles are started in BattlePreparePage.\n    resumeBattle();\n\n    async function resumeBattle() {\n        try {\n            const res = await battleAPI.getBattleState(userId);\n            if (res.code === 200) {\n                battleState = res.data;\n                renderBattle(battleState);\n                checkTurn();\n            } else {\n                router.navigate('/hall'); // No active battle\n            }\n        } catch (e) { router.navigate('/hall'); }\n    }\n\n    function renderBattle(state) {\n        if (!state) return;\n\n        updateHero('a', state.sideA.hero);\n        updateTroops('a', state.sideA.troops);\n        updateHero('b', state.sideB.hero);\n        updateTroops('b', state.sideB.troops);\n\n        document.getElementById('turn-display').textContent = `Turn ${state.turnNo}`;\n    }\n\n    function updateHero(side, hero) {\n        const el = document.getElementById(`hero-${side}`);\n        const hpFill = el.querySelector('.hp-fill');\n        const hpText = el.querySelector('.hp-text');\n        const pct = Math.max(0, Math.min(100, (hero.hp / hero.maxHp) * 100));\n        hpFill.style.width = pct + '%';\n        hpText.textContent = `${hero.hp}/${hero.maxHp}`;\n        el.querySelector('.hero-name').textContent = hero.name;\n\n        if (hero.hp <= 0) el.style.opacity = '0.5';\n    }\n\n    function updateTroops(side, troops) {\n        const container = document.getElementById(`troops-${side}`);\n        container.innerHTML = troops.map(t => `\n        <div class=\"troop-unit ${t.count <= 0 ? 'troop-dead' : ''}\">\n           <span>${getTroopIcon(t.type)} ${t.name || t.type}</span>\n           <span>x${t.count}</span>\n        </div>\n      `).join('');\n    }\n\n    function getTroopIcon(type) {\n        if (type === 'INF') return 'ğŸ›¡ï¸';\n        if (type === 'ARC') return 'ğŸ¹';\n        if (type === 'CAV') return 'ğŸ';\n        return 'âš”ï¸';\n    }\n\n    function checkTurn() {\n        if (!battleState) return;\n\n        // Show Phase\n        const phaseEl = document.getElementById('phase-display');\n        const phaseCode = battleState.phase || 'HERO_SOLO';\n        if (phaseEl) {\n            const phase = (phaseCode === 'TROOP_WAR') ? \"ğŸ”¥ å…¨å†›å‡ºå‡»\" : \"âš”ï¸ æ­¦å°†å•æŒ‘\";\n            phaseEl.textContent = phase;\n            phaseEl.className = (phaseCode === 'TROOP_WAR') ? \"phase-badge war\" : \"phase-badge solo\";\n        }\n\n        if (battleState.finished) {\n            showResult(battleState.win);\n            return;\n        }\n\n        const statusEl = document.getElementById('action-status');\n        const btnGroup = document.getElementById('action-buttons');\n        const btnAttack = document.getElementById('btn-attack');\n        const btnSkill = document.getElementById('btn-skill');\n\n        // Always Player Control for Next Round\n        statusEl.style.display = 'none';\n        btnGroup.style.display = 'flex';\n\n        // Read direct mapped hero state from sideA.\n        const hero = battleState.sideA.hero;\n\n        btnAttack.textContent = `âš”ï¸ ${battleState.currentTurn + 1}å›åˆ: å¼€å§‹`;\n\n        if (phaseCode === 'TROOP_WAR') {\n            btnSkill.disabled = true;\n            btnSkill.textContent = `é˜¶æ®µ2ä¸å¯ç”¨`;\n        } else if ((hero.skillCd || 0) > 0) {\n            btnSkill.disabled = true;\n            btnSkill.textContent = `æŠ€èƒ½å†·å´ (${hero.skillCd})`;\n        } else {\n            btnSkill.disabled = false;\n            btnSkill.textContent = `âœ¨ é‡Šæ”¾æŠ€èƒ½`;\n        }\n\n        btnAttack.onclick = () => doTurn(false);\n        btnSkill.onclick = () => doTurn(true);\n    }\n\n    function addLogs(events) {\n        if (!events) return;\n        const container = document.getElementById('logs-content');\n\n        // Process V3 Events\n        events.forEach(ev => {\n            const div = document.createElement('div');\n            div.className = 'log-entry';\n            let msg = \"\";\n\n            // Map Type\n            switch (ev.type) {\n                case 'TURN_START':\n                    msg = `<span class=\"log-highlight\">=== ç¬¬ ${ev.turn} å›åˆ ===</span>`;\n                    break;\n                case 'PHASE_CHANGE':\n                    msg = `<span class=\"log-highlight\" style=\"font-size:1.1em\">âš ï¸ é˜¶æ®µåˆ‡æ¢: ${ev.fromPhase || 'HERO_SOLO'} -> ${ev.toPhase || 'TROOP_WAR'}</span>`;\n                    break;\n                case 'HERO_ATTACK':\n                    msg = `[${ev.actorSide === 'my' ? 'æˆ‘æ–¹' : 'æ•Œæ–¹'}] ä¸»å°†æ™®æ”»`;\n                    break;\n                case 'HERO_SKILL':\n                    msg = `[${ev.actorSide === 'my' ? 'æˆ‘æ–¹' : 'æ•Œæ–¹'}] é‡Šæ”¾æŠ€èƒ½! (Dmg: ${ev.value})`;\n                    break;\n                case 'TROOP_ATTACK':\n                    // Show Roll\n                    const roll = ev.rollToHero || 0;\n                    msg = `[${ev.actorSide === 'my' ? 'æˆ‘æ–¹' : 'æ•Œæ–¹'}] ${getTroopName(ev.attackerTroopType)} è¿›æ”»! ` +\n                        `<span style=\"color:#ffd700\">ğŸ²Roll: ${roll}</span> ` +\n                        `(${roll}% æ‰“ä¸»å°†, ${100 - roll}% æ‰“å…µ)`;\n                    break;\n                case 'HERO_HP_CHANGE':\n                    const val = ev.value;\n                    msg = `> [${ev.side === 'my' ? 'æˆ‘æ–¹' : 'æ•Œæ–¹'}] ä¸»å°† ` +\n                        (val < 0 ? `<span class=\"log-dmg\">HP ${val}</span>` : `<span class=\"log-heal\">HP +${val}</span>`);\n                    break;\n                case 'TROOP_STACK_CHANGE':\n                    msg = `> [${ev.side === 'my' ? 'æˆ‘æ–¹' : 'æ•Œæ–¹'}] ${getTroopName(ev.troopType)}: ` +\n                        `<span class=\"log-dmg\">æŸå¤± ${ev.killed} å•ä½</span> (Remaining: ${ev.countAfter})`;\n                    break;\n                default:\n                    // Legacy Fallback\n                    if (ev.desc) msg = ev.desc;\n                    else msg = JSON.stringify(ev);\n            }\n\n            div.innerHTML = msg;\n            container.prepend(div);\n        });\n    }\n\n    function getTroopName(type) {\n        return getTroopTypeName(type);\n    }\n\n    async function doTurn(castSkill) {\n        if (isProcessing) return;\n        isProcessing = true;\n\n        // Optimistic UI Update? No, wait for response.\n\n        // Pass Tactics\n        try {\n            const res = await battleAPI.processTurn(\n                userId,\n                castSkill,\n                battleState.turnNo + 1,\n                currentTactics\n            );\n\n            if (res.code === 200) {\n                const newState = res.data;\n                if (newState.lastEvents) addLogs(newState.lastEvents);\n                battleState = newState;\n                renderBattle(newState);\n                isProcessing = false;\n                checkTurn();\n            } else {\n                // idempotent retry or error?\n                console.error(res.message);\n                isProcessing = false;\n            }\n        } catch (e) {\n            console.error(e);\n            isProcessing = false;\n        }\n    }\n\n    function showResult(win) {\n        const modal = document.getElementById('result-modal');\n        const title = document.getElementById('result-title');\n        const desc = document.getElementById('result-desc');\n\n        modal.style.display = 'flex';\n        title.textContent = win ? 'VICTORY!' : 'DEFEAT';\n        title.style.color = win ? 'var(--success-color)' : 'var(--danger-color)';\n        desc.textContent = win ? 'æˆ˜æ–—èƒœåˆ©ï¼è·å¾—é‡‘å¸ä¸æˆ˜åˆ©å“ã€‚' : 'æˆ˜æ–—å¤±è´¥ï¼Œè¯·å¼ºåŒ–æ­¦å°†åå†è¯•ã€‚';\n\n        document.getElementById('result-ok').onclick = () => {\n            router.navigate('/hall');\n        };\n    }\n\n    document.getElementById('flee-btn').addEventListener('click', () => {\n        if (confirm(\"ç¡®å®šè¦æ’¤é€€å—ï¼Ÿ(è§†ä¸ºæˆ˜è´¥)\")) {\n            router.navigate('/hall');\n        }\n    });\n}\n","import { hallAPI, playerAPI, battleAPI, troopAPI } from '../api/index.js';\nimport { router } from '../utils/router.js';\nimport { getTroopMeta } from '../config/gameData.js';\n\nexport function BattlePreparePage(container, params) {\n    const userId = localStorage.getItem('userId');\n    if (!userId) { router.navigate('/login'); return; }\n\n    // params comes from router, e.g. { civ: 'CN', stageNo: 1 }\n    const { civ, stageNo } = params;\n    if (!civ || !stageNo) { router.navigate('/hall'); return; }\n\n    // State\n    let generals = [];\n    let selectedGeneralId = null;\n    let userTroops = [];\n    let troopConfig = {}; // troopId -> count\n\n    container.innerHTML = `\n      <div class=\"prepare-page\">\n        <div class=\"page-header\">\n           <button class=\"btn btn-sm btn-secondary\" id=\"back-btn\">â† æ”¾å¼ƒå‡ºå¾</button>\n           <h2>âš”ï¸ æˆ˜å‰æ•´å¤‡ - ${civ} ç¬¬${stageNo}å…³</h2>\n        </div>\n        \n        <div class=\"prepare-content\">\n           <!-- 1. é€‰æ‹©ä¸»å°† -->\n           <div class=\"section-title\">1. é€‰æ‹©ä¸»å°†</div>\n           <div class=\"generals-list\" id=\"generals-list\">\n              <div class=\"spinner\"></div>\n           </div>\n           \n           <!-- 2. åˆ†é…å…µåŠ› -->\n           <div class=\"section-title\">2. åˆ†é…å…µåŠ› <span id=\"capacity-display\" style=\"font-size:0.9rem; margin-left:10px; color:#aaa;\">(ç»Ÿç‡: --/--)</span></div>\n           <div class=\"troops-list\" id=\"troops-list\">\n              <div class=\"empty-tip\">è¯·å…ˆé€‰æ‹©ä¸»å°†</div>\n           </div>\n        </div>\n        \n        <div class=\"page-footer\">\n           <button class=\"btn btn-primary btn-lg btn-block\" id=\"start-btn\" disabled>å‡ºå¾ï¼</button>\n        </div>\n        \n        <div class=\"toast\" id=\"toast\"></div>\n      </div>\n    `;\n\n    // Styles\n    const style = document.createElement('style');\n    style.id = 'prepare-page-style';\n    document.getElementById('prepare-page-style')?.remove();\n    style.textContent = `\n      .prepare-page { min-height: 100vh; background: #1a1a2e; color: #fff; display: flex; flex-direction: column; }\n      .page-header { padding: 15px 20px; background: rgba(0,0,0,0.3); display: flex; align-items: center; gap: 20px; }\n      .page-header h2 { margin: 0; font-size: 1.2rem; color: var(--accent-color); }\n      \n      .prepare-content { flex: 1; padding: 20px; max-width: 800px; margin: 0 auto; width: 100%; overflow-y: auto; }\n      .section-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 15px; border-left: 4px solid var(--primary-color); padding-left: 10px; }\n      \n      .generals-list { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 30px; }\n      .general-card { \n         min-width: 200px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 15px;\n         cursor: pointer; transition: all 0.2s; display: flex; gap: 10px; align-items: center;\n      }\n      .general-card.selected { border-color: var(--accent-color); background: rgba(255,215,0,0.1); box-shadow: 0 0 10px rgba(255,215,0,0.2); }\n      .g-avatar { width: 40px; height: 40px; background: var(--primary-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }\n      .g-name { font-weight: bold; font-size: 0.95rem; }\n      .g-lv { font-size: 0.8rem; color: #aaa; margin-left: 5px; }\n      .g-stats { font-size: 0.8rem; color: #ccc; margin-top: 4px; display: flex; flex-direction: column; }\n      \n      .troops-list { display: flex; flex-direction: column; gap: 10px; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; }\n      .troop-row { display: flex; align-items: center; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }\n      .t-name { font-weight: bold; }\n      .t-control { display: flex; align-items: center; gap: 5px; }\n      .troop-input { width: 60px; text-align: center; padding: 5px; background: #333; border: 1px solid #555; color: #fff; border-radius: 4px; }\n      .btn-tiny { padding: 2px 8px; background: #444; border: none; color: #fff; border-radius: 4px; cursor: pointer; }\n      .btn-tiny:hover { background: #555; }\n      \n      .page-footer { padding: 20px; background: rgba(0,0,0,0.5); text-align: center; }\n      .btn-block { width: 100%; max-width: 300px; padding: 12px; font-size: 1.1rem; }\n      \n      .empty-tip { text-align: center; color: #777; padding: 20px; }\n    `;\n    document.head.appendChild(style);\n\n    init();\n\n    async function init() {\n        try {\n            const [gRes, pRes, cRes] = await Promise.all([\n                hallAPI.getGenerals(userId),\n                playerAPI.getInfo(userId),\n                troopAPI.getCodex(userId)\n            ]);\n\n            if (gRes.code === 200) {\n                generals = gRes.data.filter(g => g.activated);\n                renderGenerals();\n            }\n\n            // Build unlocked set from Codex\n            const unlockedSet = new Set();\n            if (cRes.code === 200 && cRes.data) {\n                cRes.data.forEach(t => {\n                    // Filter: Must be Unlocked (status >= 2) AND Match current Civ context\n                    // (Assuming you can only deploy troops of the civ you are playing, \n                    // or maybe the Stage Civ is the context. \n                    // Let's assume 'civ' param determines the faction we are playing as for this battle config)\n                    if (t.status >= 2 && t.civ === civ) {\n                        unlockedSet.add(t.troopId);\n                    }\n                });\n            }\n\n            if (pRes.code === 200 && pRes.data.troops) {\n                userTroops = (pRes.data.troops || [])\n                    .filter(t => unlockedSet.has(t.troopId) && (t.count || 0) > 0)\n                    .sort((a, b) => (a.troopId || 0) - (b.troopId || 0));\n            }\n        } catch (e) { console.error(e); }\n    }\n\n    function renderGenerals() {\n        const list = document.getElementById('generals-list');\n        if (generals.length === 0) {\n            list.innerHTML = '<div class=\"empty-tip\">æ²¡æœ‰æ¿€æ´»çš„æ­¦å°†ï¼Œè¯·å…ˆå»å¤§å…æ¿€æ´»</div>';\n            return;\n        }\n\n        list.innerHTML = generals.map(g => `\n           <div class=\"general-card ${selectedGeneralId === g.id ? 'selected' : ''}\" data-id=\"${g.id}\">\n              <div class=\"g-avatar\">ğŸ¤´</div>\n              <div class=\"g-info\">\n                 <div class=\"g-name\">${g.name} <span class=\"g-lv\">Lv.${g.level}</span></div>\n                 <div class=\"g-stats\">\n                    <span style=\"color:var(--accent-color)\">CAP: ${g.capacity || 0}</span>\n                 </div>\n              </div>\n           </div>\n        `).join('');\n\n        list.querySelectorAll('.general-card').forEach(el => {\n            el.addEventListener('click', () => selectGeneral(parseInt(el.dataset.id)));\n        });\n\n        // Auto select first if none selected\n        if (!selectedGeneralId && generals.length > 0) {\n            selectGeneral(generals[0].id);\n        }\n    }\n\n    function selectGeneral(id) {\n        selectedGeneralId = id;\n\n        // Update selection visually\n        document.querySelectorAll('.general-card').forEach(el => {\n            el.classList.toggle('selected', parseInt(el.dataset.id) === id);\n        });\n\n        renderTroops();\n        updateCapacity();\n    }\n\n    function renderTroops() {\n        if (!selectedGeneralId) return;\n        const list = document.getElementById('troops-list');\n\n        if (userTroops.length === 0) {\n            list.innerHTML = '<div class=\"empty-tip\">æ²¡æœ‰å…µåŠ›ï¼Œè¯·å…ˆå»æ‹›å‹Ÿ</div>';\n            return;\n        }\n\n        list.innerHTML = userTroops.map(t => {\n            const def = getTroopMeta(t.troopId);\n            const currentVal = troopConfig[t.troopId] || 0;\n            // Use t.count instead of t.totalCount (backend field name mismatch)\n            const total = t.count || 0;\n\n            return `\n            <div class=\"troop-row\">\n               <div class=\"t-name\">${def.icon} ${def.name}${def.isElite ? ' [ç‰¹ç§]' : ''} (ä½™:${total})</div>\n               <div class=\"t-control\">\n                  <button class=\"btn-tiny btn-minus\" data-id=\"${t.troopId}\">-10</button>\n                  <input type=\"number\" class=\"troop-input\" id=\"input-${t.troopId}\" value=\"${currentVal}\" max=\"${total}\" min=\"0\">\n                  <button class=\"btn-tiny btn-plus\" data-id=\"${t.troopId}\">+10</button>\n               </div>\n            </div>\n            `;\n        }).join('');\n\n        // Bind events\n        userTroops.forEach(t => {\n            const input = document.getElementById('input-' + t.troopId);\n            if (!input) return;\n\n            input.onchange = (e) => {\n                let val = parseInt(e.target.value) || 0;\n                // Fix updateConfig to use t.count\n                updateConfig(t.troopId, val);\n            };\n        });\n\n        list.querySelectorAll('.btn-minus').forEach(btn => {\n            btn.onclick = () => {\n                const id = parseInt(btn.dataset.id);\n                updateConfig(id, (troopConfig[id] || 0) - 10);\n            };\n        });\n\n        list.querySelectorAll('.btn-plus').forEach(btn => {\n            btn.onclick = () => {\n                const id = parseInt(btn.dataset.id);\n                updateConfig(id, (troopConfig[id] || 0) + 10);\n            };\n        });\n\n        updateCapacity();\n    }\n\n    function updateConfig(troopId, val) {\n        const troop = userTroops.find(t => t.troopId === troopId);\n        if (!troop) return;\n\n        // Clamp\n        const max = troop.count || 0;\n        val = Math.max(0, Math.min(val, max));\n        troopConfig[troopId] = val;\n\n        const input = document.getElementById('input-' + troopId);\n        if (input) input.value = val;\n\n        updateCapacity();\n    }\n\n    function updateCapacity() {\n        const gen = generals.find(g => g.id === selectedGeneralId);\n        if (!gen) return;\n\n        const totalSoldiers = Object.values(troopConfig).reduce((a, b) => a + b, 0);\n        const usedCapacity = Object.entries(troopConfig).reduce((sum, [tid, cnt]) => {\n            const meta = getTroopMeta(parseInt(tid, 10));\n            return sum + (cnt || 0) * (meta.capCost || 1);\n        }, 0);\n        // Rule: occupied capacity <= capacity\n        const maxSoldiers = gen.capacity || 0;\n\n        const capEl = document.getElementById('capacity-display');\n        capEl.textContent = `(ç»Ÿç‡å ç”¨: ${usedCapacity}/${maxSoldiers}ï¼Œæ€»å…µæ•°: ${totalSoldiers})`;\n\n        const btn = document.getElementById('start-btn');\n        const isValid = totalSoldiers > 0 && usedCapacity <= maxSoldiers;\n\n        btn.disabled = !isValid;\n\n        if (usedCapacity > maxSoldiers) {\n            capEl.style.color = 'var(--danger-color)';\n            btn.textContent = \"å…µåŠ›è¶…è¿‡ç»Ÿç‡ä¸Šé™\";\n        } else if (totalSoldiers === 0) {\n            capEl.style.color = '#aaa';\n            btn.textContent = \"è¯·åˆ†é…å…µåŠ›\";\n        } else {\n            capEl.style.color = 'var(--success-color)';\n            btn.textContent = \"å‡ºå¾ï¼\";\n        }\n    }\n\n    document.getElementById('start-btn').onclick = async () => {\n        const btn = document.getElementById('start-btn');\n        btn.disabled = true;\n        btn.textContent = \"å‡ºå¾ä¸­...\";\n        try {\n            const res = await battleAPI.startStoryBattle(userId, civ, stageNo, selectedGeneralId, troopConfig);\n            if (res.code === 200) {\n                // Navigate to BattlePage, which will call getBattleState to resume\n                router.navigate('/battle');\n            } else {\n                alert(res.message || \"å‡ºå¾å¤±è´¥\");\n                btn.disabled = false;\n                btn.textContent = \"å‡ºå¾ï¼\";\n            }\n        } catch (e) {\n            console.error(e);\n            alert(\"è¯·æ±‚å¤±è´¥\");\n            btn.disabled = false;\n            btn.textContent = \"å‡ºå¾ï¼\";\n        }\n    };\n\n    document.getElementById('back-btn').onclick = () => router.navigate('/stages');\n}\n","import { troopAPI } from '../api/index.js';\nimport { router } from '../utils/router.js';\nimport { getTroopMeta, getTroopTypeName } from '../config/gameData.js';\n\nexport function CodexPage(container) {\n    const userId = localStorage.getItem('userId');\n    if (!userId) { router.navigate('/login'); return; }\n\n    container.innerHTML = `\n    <div class=\"codex-page\">\n      <nav class=\"page-nav\">\n        <button class=\"btn btn-secondary btn-sm\" id=\"back-btn\">â† è¿”å›å¤§å…</button>\n        <h1 class=\"page-title\">å…µç§å›¾é‰´</h1>\n      </nav>\n\n      <div class=\"codex-content\">\n        <div class=\"filters\">\n            <button class=\"filter-btn active\" data-filter=\"all\">å…¨éƒ¨</button>\n            <button class=\"filter-btn\" data-filter=\"CN\">æ±‰</button>\n            <button class=\"filter-btn\" data-filter=\"JP\">å’Œ</button>\n            <button class=\"filter-btn\" data-filter=\"KR\">é²œ</button>\n            <button class=\"filter-btn\" data-filter=\"GB\">è‹±</button>\n        </div>\n        <div id=\"codex-list\" class=\"codex-grid\">\n          <div class=\"spinner\"></div>\n        </div>\n      </div>\n      \n      <div class=\"toast\" id=\"toast\"></div>\n    </div>\n  `;\n\n    // Styles\n    const style = document.createElement('style');\n    style.id = 'codex-page-style';\n    document.getElementById('codex-page-style')?.remove();\n    style.textContent = `\n    .codex-page { min-height: 100vh; background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-medium) 100%); }\n    .page-nav { background: rgba(0,0,0,0.3); backdrop-filter: blur(10px); padding: var(--spacing-md) var(--spacing-lg); display:flex; align-items:center; gap: var(--spacing-lg); border-bottom: 2px solid rgba(255,255,255,0.1); position: sticky; top: 0; z-index: 100; }\n    .page-title { flex: 1; font-size: 1.3rem; background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }\n    \n    .codex-content { max-width: 1000px; margin: 0 auto; padding: var(--spacing-xl); display: flex; flex-direction: column; gap: var(--spacing-lg); }\n    \n    .filters { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; }\n    .filter-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #ccc; padding: 6px 16px; border-radius: 20px; cursor: pointer; transition: all 0.2s; }\n    .filter-btn.active, .filter-btn:hover { background: var(--primary-color); color: #fff; border-color: var(--primary-color); }\n    \n    .codex-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }\n    \n    .codex-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 16px; display: flex; flex-direction: column; gap: 12px; position: relative; overflow: hidden; transition: transform 0.2s; }\n    .codex-card:hover { transform: translateY(-2px); background: rgba(255,255,255,0.08); }\n    .codex-card.locked { opacity: 0.7; filter: grayscale(0.8); }\n    \n    .card-header { display: flex; align-items: center; gap: 12px; }\n    .avatar { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; background: #333; position: relative; }\n    .civ-badge { position: absolute; bottom: -2px; right: -2px; font-size: 0.7rem; background: #000; padding: 2px 4px; border-radius: 4px; border: 1px solid #555; }\n    \n    .card-info h3 { margin: 0; font-size: 1.1rem; color: #fff; }\n    .card-info p { margin: 2px 0 0; font-size: 0.85rem; color: #aaa; }\n    \n    .card-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.9rem; color: #ddd; background: rgba(0,0,0,0.2); padding: 8px; border-radius: 6px; }\n    .stat-row { display: flex; justify-content: space-between; }\n    \n    .evolution-section { border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; margin-top: auto; }\n    .evo-status { font-size: 0.85rem; color: #aaa; display: flex; justify-content: space-between; align-items: center; }\n    .evo-btn { padding: 4px 12px; font-size: 0.85rem; }\n    \n    .locked-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; flex-direction: column; z-index: 10; backdrop-filter: blur(2px); text-align: center; padding: 20px; }\n    .lock-icon { font-size: 2rem; margin-bottom: 10px; }\n    .lock-text { color: #ef4444; font-weight: bold; font-size: 0.9rem; }\n    \n    .toast { position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); padding: 12px 28px; border-radius: var(--radius-lg); font-weight: bold; opacity: 0; pointer-events: none; transition: opacity .3s ease, transform .3s ease; z-index: 999; }\n    .toast.show { opacity: 1; transform: translateX(-50%) translateY(-10px); }\n    .toast.success { background: var(--success-color); color:#fff; }\n    .toast.error { background: var(--danger-color); color:#fff; }\n  `;\n    document.head.appendChild(style);\n\n    let allTroops = [];\n    let currentFilter = 'all';\n\n    loadData();\n\n    async function loadData() {\n        try {\n            const res = await troopAPI.getCodex(userId);\n            if (res.code === 200 && res.data) {\n                allTroops = res.data;\n                renderList();\n            }\n        } catch (e) {\n            console.error(e);\n            document.getElementById('codex-list').innerHTML = '<div style=\"text-align:center;width:100%\">åŠ è½½å¤±è´¥</div>';\n        }\n    }\n\n    function renderList() {\n        const list = document.getElementById('codex-list');\n        let filtered = allTroops;\n\n        if (currentFilter !== 'all') {\n            filtered = allTroops.filter(t => t.civ === currentFilter);\n        }\n\n        // Sort: Unlocked -> Locked, then ID\n        filtered.sort((a, b) => {\n            if (a.status !== b.status) return b.status - a.status;\n            return a.troopId - b.troopId;\n        });\n\n        list.innerHTML = filtered.map(t => {\n            const meta = getTroopMeta(t.troopId);\n            const isLocked = t.status < 2; // 0 or 1 (Discovered but not unlocked) -> Treat as locked for usage, but shown in codex\n            // Actually, status 0=Locked (Hidden/Gray), 1=Discovered (Visible but gray), 2=Unlocked (Color)\n            // Let's assume server returns everything.\n\n            const isHidden = t.status === 0; // Completely unknown? Maybe show silhouette?\n\n            // For now, render everything but style differently\n            return `\n            <div class=\"codex-card ${isLocked ? 'locked' : ''}\">\n                <div class=\"card-header\">\n                    <div class=\"avatar\" style=\"background:${meta.color}\">\n                        ${isHidden ? '?' : meta.icon}\n                        <span class=\"civ-badge\">${t.civ}</span>\n                    </div>\n                    <div class=\"card-info\">\n                        <h3>${t.name}</h3>\n                        <p>${getTroopTypeName(t.type)} ${t.isElite ? 'Â· ç‰¹ç§' : ''}</p>\n                    </div>\n                </div>\n                \n                <div class=\"card-stats\">\n                    <div class=\"stat-row\"><span>æ”»å‡»</span> <strong>${t.baseAtk}</strong></div>\n                    <div class=\"stat-row\"><span>ç”Ÿå‘½</span> <strong>${t.baseHp}</strong></div>\n                    <div class=\"stat-row\"><span>ç»Ÿç‡</span> <strong>${t.cost}</strong></div>\n                    <div class=\"stat-row\"><span>å°„ç¨‹</span> <strong>${t.type === 'ARC' ? 'è¿œ' : 'è¿‘'}</strong></div>\n                </div>\n                \n                <div class=\"evolution-section\">\n                    <div class=\"evo-status\">\n                        <span>è¿›åŒ–é˜¶æ®µ: ${t.evolutionTier || 0}é˜¶</span>\n                        ${!isLocked && t.evolutionUnlocked\n                    ? `<button class=\"btn btn-primary btn-sm evo-btn\" data-id=\"${t.troopId}\">è¿›åŒ–</button>`\n                    : '<span style=\"font-size:0.8em;color:#777\">è¿›åŒ–æœªè§£é”</span>'}\n                    </div>\n                </div>\n                \n                ${isLocked ? `\n                    <div class=\"locked-overlay\">\n                        <div class=\"lock-icon\">ğŸ”’</div>\n                        <div class=\"lock-text\">\n                            ${t.status === 1 ? 'å·²å‘ç°' : 'æœªè§£é”'}<br>\n                            <span style=\"font-size:0.8em;color:#aaa\">${t.unlockHint || `éœ€é€šå…³ ${t.civ} å…³å¡`}</span>\n                        </div>\n                    </div>\n                ` : ''}\n            </div>\n        `;\n        }).join('');\n\n        // Bind events\n        document.querySelectorAll('.evo-btn').forEach(btn => {\n            btn.onclick = () => handleEvolve(btn.dataset.id);\n        });\n    }\n\n    async function handleEvolve(troopId) {\n        if (!confirm('ç¡®å®šè¦è¿›åŒ–è¯¥å…µç§å—ï¼Ÿéœ€è¦æ¶ˆè€—é‡‘å¸å¹¶æ»¡è¶³å…³å¡æ¡ä»¶ã€‚')) return;\n\n        try {\n            const res = await troopAPI.evolve(userId, parseInt(troopId));\n            if (res.code === 200) {\n                showToast('è¿›åŒ–æˆåŠŸï¼', 'success');\n                loadData(); // Reload to see updates\n            } else {\n                showToast(res.message || 'è¿›åŒ–å¤±è´¥', 'error');\n            }\n        } catch (e) {\n            showToast(e.message || 'è¯·æ±‚å¤±è´¥', 'error');\n        }\n    }\n\n    // Filter events\n    document.querySelectorAll('.filter-btn').forEach(btn => {\n        btn.onclick = () => {\n            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));\n            btn.classList.add('active');\n            currentFilter = btn.dataset.filter;\n            renderList();\n        };\n    });\n\n    document.getElementById('back-btn').addEventListener('click', () => router.navigate('/hall'));\n\n    function showToast(msg, type = 'success') {\n        const toast = document.getElementById('toast');\n        toast.textContent = msg;\n        toast.className = `toast ${type} show`;\n        setTimeout(() => { toast.className = 'toast'; }, 2000);\n    }\n}\n","import { router } from './utils/router.js';\nimport { LoginPage } from './pages/LoginPage.js';\nimport { HallPage } from './pages/HallPage.js';\nimport { RecruitPage } from './pages/RecruitPage.js';\nimport { GeneralsPage } from './pages/GeneralsPage.js';\nimport { StageSelectionPage } from './pages/StageSelectionPage.js';\nimport { EquipmentPage } from './pages/EquipmentPage.js';\nimport { GemPage } from './pages/GemPage.js';\nimport { SkillPage } from './pages/SkillPage.js';\nimport { BattlePage } from './pages/BattlePage.js';\nimport { BattlePreparePage } from './pages/BattlePreparePage.js';\nimport { CodexPage } from './pages/CodexPage.js';\n\n// æ³¨å†Œè·¯ç”±\nrouter.register('/login', LoginPage);\nrouter.register('/hall', HallPage);\nrouter.register('/recruit', RecruitPage);\nrouter.register('/generals', GeneralsPage);\nrouter.register('/stages', StageSelectionPage);\nrouter.register('/equipment', EquipmentPage);\nrouter.register('/gem', GemPage);\nrouter.register('/skill', SkillPage);\nrouter.register('/battle', BattlePage);\nrouter.register('/battle/prepare', BattlePreparePage);\nrouter.register('/codex', CodexPage);\n\n// åˆå§‹åŒ–åº”ç”¨\nfunction init() {\n    // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•\n    const userId = localStorage.getItem('userId');\n\n    if (userId) {\n        router.navigate('/hall');\n    } else {\n        router.navigate('/login');\n    }\n}\n\n// å¯åŠ¨åº”ç”¨\ninit();\n"],"names":["Router","path","component","params","app","router","API_BASE_URL","API","endpoint","options","url","config","response","contentType","data","msg","error","query","body","authAPI","username","password","nickname","initialCiv","playerAPI","userId","hallAPI","generalId","troopId","count","equipmentId","bookItemId","socketIndex","gemId","gemType","level","battleAPI","civ","stageNo","troopConfig","castSkill","clientTurnNo","tactics","troopAPI","LoginPage","container","style","_a","isRegisterMode","selectedCiv","usernameInput","passwordInput","nicknameInput","registerFields","loginBtn","registerBtn","messageEl","civOptions","opt","o","showMessage","text","type","handleLoginSuccess","user","result","e","TROOP_CATALOG","EQUIPMENT_SLOT_LABEL","SKILL_BOOK_META","getTroopMeta","getTroopTypeName","getEquipmentSlotLabel","slot","getEquipmentSlotIcon","HallPage","loadPlayerData","loadGenerals","loadProgress","renderTroops","grid","general","civNames","prog","troops","list","t","meta","b","typeOrder","troop","RecruitPage","loadData","infoRes","codexRes","ownedTroopsMap","codexList","a","ownedMap","isLocked","opacity","grayscale","bindEvents","btn","input","delta","val","res","showToast","toast","GeneralsPage","allEquipments","currentGeneralId","SLOT_CONFIG","loadAll","generalsRes","equipRes","playerRes","contentEl","renderGenerals","generals","g","slotsHtml","eq","handleAction","openEquipModal","gId","sKey","available","content","s","it","equip","eid","action","id","p","StageSelectionPage","currentCiv","progressData","init","renderStages","progRes","civProg","totalStages","cleared","i","isCleared","isUnlocked","card","typeText","enterBattlePrepare","stage","EquipmentPage","styleEl","lv","cost","name","icon","slotName","enhance","isFail","GemPage","allGems","gemRes","gemList","groups","key","grp","combine","equipList","span","ev","openUseGemModal","currentEquipId","currentSocketIdx","equipId","socketIdx","unusedGems","item","inlayGem","SkillPage","selectedGeneralId","items","genRes","itemRes","renderBooks","books","learn","itemId","BattlePage","battleState","isProcessing","currentTactics","resumeBattle","renderBattle","checkTurn","state","updateHero","updateTroops","side","hero","el","hpFill","hpText","pct","getTroopIcon","phaseEl","phaseCode","phase","showResult","statusEl","btnGroup","btnAttack","btnSkill","doTurn","addLogs","events","div","roll","getTroopName","newState","win","modal","title","desc","BattlePreparePage","userTroops","gRes","pRes","cRes","unlockedSet","selectGeneral","updateCapacity","def","currentVal","total","updateConfig","max","gen","totalSoldiers","usedCapacity","sum","tid","cnt","maxSoldiers","capEl","isValid","CodexPage","allTroops","currentFilter","renderList","filtered","isHidden","handleEvolve"],"mappings":"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"}